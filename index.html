<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡ßß‡ß® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .user-info { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 3px solid #667eea; overflow-x: auto; }
        .tab { flex: 1; min-width: 150px; padding: 20px; text-align: center; cursor: pointer; font-weight: bold; background: #f8f9fa; border: none; font-size: 16px; transition: all 0.3s; }
        .tab:hover { background: #e9ecef; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; margin-bottom: -3px; }
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { background: #667eea; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: bold; transition: all 0.3s; margin: 5px; }
        .btn:hover { background: #764ba2; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-sm { padding: 8px 15px; font-size: 12px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 20px; border-radius: 12px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-card.red { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .stat-card.blue { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .stat-card h3 { font-size: 13px; margin-bottom: 8px; opacity: 0.9; }
        .stat-card .amount { font-size: 26px; font-weight: bold; }
        .form-card { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .form-card h3 { color: #667eea; margin-bottom: 20px; font-size: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 8px; color: #495057; font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 15px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; }
        .form-group textarea { resize: vertical; min-height: 60px; }
        .transactions-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .transactions-table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: left; font-size: 14px; }
        .transactions-table td { padding: 12px 15px; border-bottom: 1px solid #dee2e6; font-size: 14px; }
        .transactions-table tr:hover { background: #f8f9fa; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; }
        .badge-income { background: #d4edda; color: #155724; }
        .badge-expense { background: #f8d7da; color: #721c24; }
        .badge-purchase { background: #cce7ff; color: #004085; }
        .badge-material { background: #fff3cd; color: #856404; }
        .badge-salary { background: #e2e3e5; color: #383d41; }
        .badge-advance { background: #fff3cd; color: #856404; }
        .partners-grid, .employees-grid, .materials-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .partner-card, .employee-card, .material-card { background: white; border: 2px solid #dee2e6; padding: 20px; border-radius: 10px; transition: all 0.3s; }
        .partner-card:hover, .employee-card:hover, .material-card:hover { border-color: #667eea; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2); transform: translateY(-2px); }
        .partner-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .partner-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        .partner-info h3 { font-size: 16px; margin-bottom: 5px; color: #212529; }
        .partner-info p { font-size: 13px; color: #6c757d; }
        .partner-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .partner-stat { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .partner-stat label { font-size: 11px; color: #6c757d; display: block; margin-bottom: 5px; }
        .partner-stat .value { font-size: 16px; font-weight: bold; color: #212529; }
        .partner-stat.income .value { color: #28a745; }
        .partner-stat.expense .value { color: #dc3545; }
        .chart-container { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .chart-container h3 { margin-bottom: 15px; color: #495057; font-size: 18px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 50px auto; padding: 30px; border-radius: 15px; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .close { font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; }
        .close:hover { color: #000; }
        .login-container { max-width: 400px; margin: 100px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header h2 { color: #667eea; margin-bottom: 10px; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold; margin-left: 8px; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .backup-section { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .file-input { display: none; }
        .file-label { background: #17a2b8; color: white; padding: 10px 15px; border-radius: 6px; cursor: pointer; display: inline-block; }
        .file-label:hover { background: #138496; }
        .sync-status { position: fixed; bottom: 10px; right: 10px; background: #28a745; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; z-index: 1000; }
        .sync-status.offline { background: #dc3545; }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .monthly-summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .monthly-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-left: 5px solid #667eea; }
        .monthly-card h3 { color: #667eea; margin-bottom: 15px; font-size: 18px; }
        .monthly-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .monthly-stat { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .monthly-stat label { font-size: 12px; color: #6c757d; display: block; margin-bottom: 5px; }
        .monthly-stat .value { font-size: 16px; font-weight: bold; }
        .monthly-stat.income .value { color: #28a745; }
        .monthly-stat.expense .value { color: #dc3545; }
        .monthly-stat.purchase .value { color: #007bff; }
        .monthly-stat.material .value { color: #ffc107; }
        .monthly-stat.salary .value { color: #6c757d; }
        .material-stock { background: #e7f3ff; padding: 10px; border-radius: 6px; margin-top: 10px; }
        .material-stock .stock-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .material-stock .stock-item:last-child { margin-bottom: 0; }
        .stock-low { color: #dc3545; font-weight: bold; }
        .stock-ok { color: #28a745; }
        .attachment-section { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .attachment-preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .attachment-item { position: relative; width: 100px; height: 100px; border: 2px solid #dee2e6; border-radius: 8px; overflow: hidden; }
        .attachment-item img { width: 100%; height: 100%; object-fit: cover; }
        .attachment-item .remove-attachment { position: absolute; top: 5px; right: 5px; background: rgba(220, 53, 69, 0.8); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer; }
        .attachment-item .file-icon { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background: #f8f9fa; font-size: 24px; }
        .image-modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); }
        .image-modal-content { margin: auto; display: block; max-width: 90%; max-height: 90%; }
        .image-modal-close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }
        .upload-progress { width: 100%; height: 5px; background: #dee2e6; border-radius: 5px; margin-top: 5px; overflow: hidden; }
        .upload-progress-bar { height: 100%; background: #28a745; transition: width 0.3s; }
        .material-transaction-item { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .material-transaction-header { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px; font-weight: bold; color: #495057; }
        .salary-payment-item { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .salary-payment-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px; font-weight: bold; color: #495057; }
        
        /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .advance-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ffc107;
        }
        
        .remaining-salary {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .project-field {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .supplier-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .password-strength {
            height: 5px;
            border-radius: 5px;
            margin-top: 5px;
            transition: all 0.3s;
        }
        
        .strength-weak { background: #dc3545; width: 25%; }
        .strength-medium { background: #ffc107; width: 50%; }
        .strength-strong { background: #28a745; width: 100%; }
    </style>
</head>
<body>
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <h2>üîê ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <p style="color: #6c757d;">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 13px;">
                <strong>‡¶°‡ßá‡¶Æ‡ßã ‡¶≤‡¶ó‡¶á‡¶®:</strong><br>
                ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: admin / admin123<br>
                ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞: viewer / viewer123
            </div>
            <div id="loginAlert" style="margin-top: 15px;"></div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <h1>üè¢ ‡ßß‡ß® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h1>
            <p>‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ - Firebase ‡¶∏‡¶π</p>
            <div class="user-info">
                <span>üë§ <strong id="currentUserName"></strong> (<span id="currentUserRole"></span>)</span>
                <button class="btn btn-danger btn-sm" onclick="logout()">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab" onclick="switchTab('transactions')">üí∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</button>
            <button class="tab" onclick="switchTab('monthly')">üìÖ ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï</button>
            <button class="tab" onclick="switchTab('materials')">üì¶ ‡¶Æ‡¶æ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</button>
            <button class="tab" onclick="switchTab('partners')">üë• ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</button>
            <button class="tab" onclick="switchTab('employees')" id="employeesTab">üë®‚Äçüíº ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ</button>
            <button class="tab" onclick="switchTab('salary')" id="salaryTab">üí∞ ‡¶¨‡ßá‡¶§‡¶®</button>
            <button class="tab" onclick="switchTab('backup')" id="backupTab">üíæ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™</button>
            <button class="tab" onclick="switchTab('settings')" id="settingsTab">‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
        </div>
        
        <div class="content">
            <div id="dashboard" class="tab-content active">
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <label style="font-weight: bold; margin-bottom: 10px; display: block;">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®:</label>
                    <select id="dashboardMonthSelect" onchange="updateDashboard()" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #dee2e6; border-radius: 8px;">
                        <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>
                    </select>
                </div>

                <div class="stats-grid">
                    <div class="stat-card green">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ <span id="totalIncome">0</span></div>
                    </div>
                    <div class="stat-card red">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</h3>
                        <div class="amount">‡ß≥ <span id="totalExpense">0</span></div>
                    </div>
                    <div class="stat-card blue">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ <span id="totalPurchase">0</span></div>
                    </div>
                    <div class="stat-card purple">
                        <h3>‡¶®‡¶ø‡¶ü ‡¶≤‡¶æ‡¶≠/‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®</h3>
                        <div class="amount">‡ß≥ <span id="netProfit">0</span></div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üìà ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                    <canvas id="dailyChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>üìä ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            
            <div id="transactions" class="tab-content">
                <div class="form-card" id="txFormCard">
                    <h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                    <form onsubmit="addTransaction(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="txDate" required onchange="updateMonthFromDate()" max="">
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡¶æ‡¶∏ *</label>
                                <select id="txMonth" required>
                                    <option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶ß‡¶∞‡¶® *</label>
                                <select id="txType" required onchange="toggleTransactionFields()">
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="income">‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º</option>
                                    <option value="expense">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</option>
                                    <option value="salary">‡¶¨‡ßá‡¶§‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶ü‡¶æ‡¶ï‡¶æ *</label>
                                <input type="number" id="txAmount" placeholder="‡ß¶" required min="0" step="0.01">
                            </div>
                            
                            <!-- ‡¶¨‡ßá‡¶§‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                            <div class="form-group" id="salaryEmployeeGroup" style="display: none;">
                                <label>‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ *</label>
                                <select id="txEmployee">
                                    <option value="">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</label>
                                <input type="text" id="txPartner" list="partnersList">
                                <datalist id="partnersList"></datalist>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label>
                                <textarea id="txDescription" required></textarea>
                            </div>
                            
                            <!-- ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø (‡¶õ‡¶¨‡¶ø/‡¶´‡¶æ‡¶á‡¶≤)</label>
                                <input type="file" id="txAttachment" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx" onchange="previewAttachments()">
                                <small style="color: #6c757d; margin-top: 5px;">‡¶õ‡¶¨‡¶ø (JPG, PNG) ‡¶¨‡¶æ ‡¶°‡¶ï‡ßÅ‡¶Æ‡ßá‡¶®‡ßç‡¶ü (PDF, DOC, XLS) ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß´‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤‡•§</small>
                                
                                <div class="upload-progress" id="uploadProgress" style="display: none;">
                                    <div class="upload-progress-bar" id="uploadProgressBar"></div>
                                </div>
                                
                                <div class="attachment-preview" id="attachmentPreview"></div>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                            <button type="reset" class="btn" onclick="resetAttachmentForm()">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">üîç ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡¶Æ‡¶æ‡¶∏</label>
                            <select id="filterMonth" onchange="renderTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶ß‡¶∞‡¶®</label>
                            <select id="filterType" onchange="renderTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶ß‡¶∞‡¶®</option>
                                <option value="income">‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º</option>
                                <option value="expense">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</option>
                                <option value="salary">‡¶¨‡ßá‡¶§‡¶®</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</label>
                            <select id="filterPartner" onchange="renderTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th>‡¶Æ‡¶æ‡¶∏</th>
                                <th>‡¶ß‡¶∞‡¶®</th>
                                <th>‡¶ü‡¶æ‡¶ï‡¶æ</th>
                                <th>‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ</th>
                                <th>‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</th>
                                <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th>‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø</th>
                                <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="monthly" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn" onclick="exportMonthlyData()">üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                </div>
                <div id="monthlySummary">
                    <!-- ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
                </div>
            </div>

            <div id="materials" class="tab-content">
                <div class="form-card" id="materialTxFormCard">
                    <h3>üõí ‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</h3>
                    <form onsubmit="addMaterialTransaction(event)" id="materialTxForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="materialTxDate" required onchange="updateMaterialMonthFromDate()" max="">
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡¶æ‡¶∏ *</label>
                                <select id="materialTxMonth" required>
                                    <option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶ß‡¶∞‡¶® *</label>
                                <select id="materialTxType" required onchange="toggleMaterialFields()">
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="purchase">‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</option>
                                    <option value="material">‡¶Æ‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                                <input type="text" id="materialTxName" list="materialsList" required>
                                <datalist id="materialsList"></datalist>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ *</label>
                                <input type="number" id="materialTxQuantity" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶è‡¶ï‡¶ï</label>
                                <input type="text" id="materialTxUnit" placeholder="‡¶ï‡ßá‡¶ú‡¶ø, ‡¶™‡¶ø‡¶∏, ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø">
                            </div>
                            
                            <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                            <div class="form-group">
                                <label>‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ/‡¶¶‡ßã‡¶ï‡¶æ‡¶®</label>
                                <input type="text" id="materialTxSupplier" placeholder="‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                                <input type="text" id="materialTxMemo" placeholder="‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                            </div>
                            
                            <div class="form-group" id="materialTxPriceGroup">
                                <label>‡¶¶‡¶æ‡¶Æ</label>
                                <input type="number" id="materialTxPrice" min="0" step="0.01">
                                <small style="color: #6c757d;">‡¶Æ‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤</small>
                            </div>
                            
                            <div class="form-group project-field">
                                <label>‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü/‡¶Ü‡¶á‡¶°‡¶ø</label>
                                <input type="text" id="materialTxProject" placeholder="‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø">
                            </div>
                            
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label>
                                <textarea id="materialTxDescription" required></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                            <button type="reset" class="btn" onclick="resetMaterialForm()">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <div style="text-align: right; margin-bottom: 20px; margin-top: 30px;">
                    <button class="btn btn-success" onclick="showAddMaterialModal()">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶≤ ‡¶Ø‡ßã‡¶ó</button>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">üîç ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡¶Æ‡¶æ‡¶∏</label>
                            <select id="materialFilterMonth" onchange="renderMaterialTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶ß‡¶∞‡¶®</label>
                            <select id="materialFilterType" onchange="renderMaterialTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶ß‡¶∞‡¶®</option>
                                <option value="purchase">‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</option>
                                <option value="material">‡¶Æ‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                            <select id="materialFilterName" onchange="renderMaterialTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶≤</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th>‡¶Æ‡¶æ‡¶∏</th>
                                <th>‡¶ß‡¶∞‡¶®</th>
                                <th>‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                                <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th>‡¶è‡¶ï‡¶ï</th>
                                <th>‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ</th>
                                <th>‡¶Æ‡ßá‡¶Æ‡ßã</th>
                                <th>‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü</th>
                                <th>‡¶¶‡¶æ‡¶Æ</th>
                                <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                            </tr>
                        </thead>
                        <tbody id="materialTransactionsBody"></tbody>
                    </table>
                </div>
                
                <div class="materials-grid" id="materialsGrid" style="margin-top: 30px;"></div>
            </div>
            
            <div id="partners" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAddPartnerModal()" id="addPartnerBtn">‚ûï ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</button>
                </div>
                <div class="partners-grid" id="partnersReport"></div>
            </div>

            <div id="employees" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAddEmployeeModal()">‚ûï ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó</button>
                </div>
                <div class="employees-grid" id="employeesGrid"></div>
            </div>
            
            <div id="salary" class="tab-content">
                <div class="form-card" id="salaryFormCard">
                    <h3>üí∞ ‡¶¨‡ßá‡¶§‡¶® ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®</h3>
                    <form onsubmit="paySalary(event)" id="salaryForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="salaryDate" required onchange="updateSalaryMonthFromDate()" max="">
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡¶æ‡¶∏ *</label>
                                <select id="salaryMonth" required>
                                    <option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ *</label>
                                <select id="salaryEmployee" required onchange="updateSalaryInfo()">
                                    <option value="">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶¨‡ßá‡¶§‡¶® *</label>
                                <input type="number" id="salaryAmount" min="0" step="0.01" required readonly>
                            </div>
                            <div class="form-group">
                                <label>‡¶¨‡ßã‡¶®‡¶æ‡¶∏</label>
                                <input type="number" id="salaryBonus" min="0" step="0.01" value="0" onchange="updateSalaryTotal()">
                            </div>
                            
                            <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶¨‡ßá‡¶§‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                            <div class="form-group">
                                <label>‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶¨‡ßá‡¶§‡¶®</label>
                                <input type="number" id="salaryAdvance" min="0" step="0.01" value="0" onchange="updateSalaryTotal()">
                            </div>
                            
                            <div class="form-group">
                                <label>‡¶Æ‡ßã‡¶ü *</label>
                                <input type="number" id="salaryTotal" min="0" step="0.01" required readonly>
                            </div>
                            
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label>
                                <textarea id="salaryDescription" required>‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶¨‡ßá‡¶§‡¶®</textarea>
                            </div>
                        </div>
                        
                        <!-- ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶¨‡ßá‡¶§‡¶® ‡¶§‡¶•‡ßç‡¶Ø -->
                        <div class="remaining-salary" id="remainingSalaryInfo" style="display: none;">
                            <div>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶¨‡ßá‡¶§‡¶®: ‡ß≥ <span id="remainingSalaryAmount">0</span></div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üí∏ ‡¶¨‡ßá‡¶§‡¶® ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®</button>
                            <button type="button" class="btn btn-warning" onclick="payAdvanceSalary()">üí∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®</button>
                            <button type="reset" class="btn" onclick="resetSalaryForm()">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h4 style="margin-bottom: 15px;">üìã ‡¶¨‡ßá‡¶§‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h4>
                    <div style="overflow-x: auto;">
                        <table class="transactions-table">
                            <thead>
                                <tr>
                                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                    <th>‡¶Æ‡¶æ‡¶∏</th>
                                    <th>‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ</th>
                                    <th>‡¶¨‡ßá‡¶§‡¶®</th>
                                    <th>‡¶¨‡ßã‡¶®‡¶æ‡¶∏</th>
                                    <th>‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ</th>
                                    <th>‡¶Æ‡ßã‡¶ü</th>
                                    <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                    <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                                </tr>
                            </thead>
                            <tbody id="salaryTransactionsBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="backup" class="tab-content">
                <div class="form-card">
                    <h3>üíæ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™</h3>
                    <p style="margin-bottom: 15px; color: #6c757d;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    
                    <div class="backup-section">
                        <button class="btn btn-success" onclick="exportToExcel()">üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                        <button class="btn btn-warning" onclick="exportToJSON()">üìÅ JSON ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                        <button class="btn" onclick="importFromJSON()">üìÇ JSON ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <input type="file" id="jsonFileInput" class="file-input" accept=".json">
                        <label for="jsonFileInput" class="file-label">üìÇ JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</label>
                        
                        <input type="file" id="excelFileInput" class="file-input" accept=".xlsx, .xls">
                        <label for="excelFileInput" class="file-label">üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</label>
                        
                        <button class="btn" onclick="importFromExcel()">üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                    </div>
                    
                    <div id="backupAlert" style="margin-top: 15px;"></div>
                </div>

                <div class="form-card">
                    <h3>üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
                    <p style="margin-bottom: 15px; color: #6c757d;">‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    
                    <div class="backup-section">
                        <button class="btn btn-success" onclick="exportTransactionsToExcel()">üí∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                        <button class="btn btn-success" onclick="exportPartnersToExcel()">üë• ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                        <button class="btn btn-success" onclick="exportEmployeesToExcel()">üë®‚Äçüíº ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                        <button class="btn btn-success" onclick="exportMaterialsToExcel()">üì¶ ‡¶Æ‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                        <button class="btn btn-success" onclick="exportSalaryToExcel()">üí∞ ‡¶¨‡ßá‡¶§‡¶® ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                        <button class="btn btn-success" onclick="exportMaterialTransactionsToExcel()">üõí ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                    </div>
                </div>
            </div>

            <div id="settings" class="tab-content">
                <div class="form-card">
                    <h3>üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</h3>
                    <div id="settingsAlert"></div>
                    <form onsubmit="changeAdminPassword(event)">
                        <div class="form-group">
                            <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="newPassword" required minlength="6" onkeyup="checkPasswordStrength(this.value)">
                            <div class="password-strength" id="passwordStrength"></div>
                            <small style="color: #6c757d;">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá</small>
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                            <input type="password" id="confirmPassword" required minlength="6">
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h3>üë§ ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</h3>
                    <div id="viewerAlert"></div>
                    <form onsubmit="changeViewerPassword(event)">
                        <div class="form-group">
                            <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="currentViewerPassword" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="newViewerPassword" required minlength="6" onkeyup="checkPasswordStrength(this.value, 'viewer')">
                            <div class="password-strength" id="viewerPasswordStrength"></div>
                            <small style="color: #6c757d;">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá</small>
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                            <input type="password" id="confirmViewerPassword" required minlength="6">
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h3>‚ö†Ô∏è ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                    <p style="margin-bottom: 15px; color: #6c757d;">‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶è‡¶á ‡¶Ö‡¶™‡¶∂‡¶®‡¶ü‡¶ø ‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Partner Modal -->
    <div id="partnerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="partnerModalTitle">‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <span class="close" onclick="closePartnerModal()">&times;</span>
            </div>
            <form onsubmit="savePartner(event)">
                <input type="hidden" id="partnerEditId">
                <div class="form-group">
                    <label>‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="partnerName" required>
                </div>
                <div class="form-group">
                    <label>‡¶´‡ßã‡¶®</label>
                    <input type="text" id="partnerPhone">
                </div>
                <div class="form-group">
                    <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</label>
                    <select id="partnerStatus">
                        <option value="active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
                        <option value="inactive">‡¶¨‡¶®‡ßç‡¶ß</option>
                    </select>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                    <button type="button" class="btn" onclick="closePartnerModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Material Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="materialModalTitle">‡¶Æ‡¶æ‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <span class="close" onclick="closeMaterialModal()">&times;</span>
            </div>
            <form onsubmit="saveMaterial(event)">
                <input type="hidden" id="materialEditId">
                <div class="form-group">
                    <label>‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="materialName" required>
                </div>
                <div class="form-group">
                    <label>‡¶è‡¶ï‡¶ï</label>
                    <input type="text" id="materialUnit" placeholder="‡¶ï‡ßá‡¶ú‡¶ø, ‡¶™‡¶ø‡¶∏, ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø">
                </div>
                <div class="form-group">
                    <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï</label>
                    <input type="number" id="materialStock" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶∏‡ßç‡¶§‡¶∞</label>
                    <input type="number" id="materialAlertLevel" min="0" step="0.01" placeholder="‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®">
                </div>
                <div class="form-group">
                    <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</label>
                    <select id="materialStatus">
                        <option value="active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
                        <option value="inactive">‡¶¨‡¶®‡ßç‡¶ß</option>
                    </select>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                    <button type="button" class="btn" onclick="closeMaterialModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <span class="close" onclick="closeEmployeeModal()">&times;</span>
            </div>
            <form onsubmit="saveEmployee(event)">
                <input type="hidden" id="employeeEditId">
                <div class="form-group">
                    <label>‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="employeeName" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡¶¶‡¶¨‡¶ø</label>
                    <input type="text" id="employeePosition">
                </div>
                <div class="form-group">
                    <label>‡¶´‡ßã‡¶®</label>
                    <input type="text" id="employeePhone">
                </div>
                <div class="form-group">
                    <label>‡¶¨‡ßá‡¶§‡¶®</label>
                    <input type="number" id="employeeSalary" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®</label>
                    <input type="date" id="employeeJoinDate">
                </div>
                <div class="form-group">
                    <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</label>
                    <select id="employeeStatus">
                        <option value="active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
                        <option value="inactive">‡¶¨‡¶®‡ßç‡¶ß</option>
                    </select>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                    <button type="button" class="btn" onclick="closeEmployeeModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <span class="image-modal-close" onclick="closeImageModal()">&times;</span>
        <img class="image-modal-content" id="modalImage">
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA9fFXPWffefF17n8KgcA6gFBGqo0kQwd8",
            authDomain: "sunnet-91692.firebaseapp.com",
            databaseURL: "https://sunnet-91692-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sunnet-91692",
            storageBucket: "sunnet-91692.firebasestorage.app",
            messagingSenderId: "494362733387",
            appId: "1:494362733387:web:f21fecafa6d39e07d756ce",
            measurementId: "G-30R6BPZTWQ"
        };

        // Firebase Initialize
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global Variables
        let transactions = [];
        let materialTransactions = [];
        let partners = [
            { id: 1, name: '‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶π‡ßã‡¶∏‡ßá‡¶®', phone: '‡ß¶‡ßß‡ß≠‡ßß‡ßß-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', status: 'active' },
            { id: 2, name: '‡¶∞‡¶π‡¶ø‡¶Æ ‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ß®‡ß®-‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', status: 'active' },
            { id: 3, name: '‡¶ï‡¶∞‡¶ø‡¶Æ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ', phone: '‡ß¶‡ßß‡ßØ‡ß©‡ß©-‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ', status: 'active' },
            { id: 4, name: '‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ß≠‡ß™‡ß™-‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ', status: 'active' },
            { id: 5, name: '‡¶ú‡¶æ‡¶π‡¶ø‡¶¶ ‡¶Ü‡¶≤‡ßÄ', phone: '‡ß¶‡ßß‡ßÆ‡ß´‡ß´-‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶', status: 'active' },
            { id: 6, name: '‡¶®‡¶æ‡¶∏‡¶ø‡¶∞ ‡¶â‡¶≤‡ßç‡¶≤‡¶æ‡¶π', phone: '‡ß¶‡ßß‡ßØ‡ß¨‡ß¨-‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶‡ßß', status: 'active' },
            { id: 7, name: '‡¶´‡¶æ‡¶∞‡ßÅ‡¶ï ‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶', phone: '‡ß¶‡ßß‡ß≠‡ß≠‡ß≠-‡ß≠‡ßÆ‡ßØ‡ß¶‡ßß‡ß®', status: 'active' },
            { id: 8, name: '‡¶∂‡¶´‡¶ø‡¶ï ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ßÆ‡ßÆ-‡ßÆ‡ßØ‡ß¶‡ßß‡ß®‡ß©', status: 'active' },
            { id: 9, name: '‡¶Æ‡¶æ‡¶π‡¶Æ‡ßÅ‡¶¶ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßØ‡ßØ‡ßØ-‡ßØ‡ß¶‡ßß‡ß®‡ß©‡ß™', status: 'active' },
            { id: 10, name: '‡¶Ü‡¶®‡ßã‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶π‡ßá‡¶¨', phone: '‡ß¶‡ßß‡ß≠‡ß¶‡ß¶-‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´', status: 'active' },
            { id: 11, name: '‡¶¨‡¶æ‡¶¨‡ßÅ‡¶≤ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ', phone: '‡ß¶‡ßß‡ßÆ‡ßß‡ßß-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', status: 'active' },
            { id: 12, name: '‡¶ï‡¶æ‡¶Æ‡¶æ‡¶≤ ‡¶™‡¶æ‡¶∂‡¶æ', phone: '‡ß¶‡ßß‡ßØ‡ß®‡ß®-‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', status: 'active' }
        ];
        let employees = [];
        let materials = [];
        let currentUser = null;
        let dailyChart = null;
        let monthlyChart = null;
        let isOnline = true;
        let currentAttachments = [];

        const monthNames = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];

        // üî• Firebase Authentication Functions
        async function initializeAuth() {
            try {
                // Check if users exist in Firestore, if not create default users
                const usersDoc = await db.collection('system').doc('users').get();
                
                if (!usersDoc.exists) {
                    // Create default users
                    await createDefaultUsers();
                }
                
                // Check if user is already signed in from localStorage
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    showMainApp();
                }
                
            } catch (error) {
                console.error('Auth initialization error:', error);
                document.getElementById('loginAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶ü‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
            }
        }

        async function createDefaultUsers() {
            try {
                // Create default users in Firestore
                const defaultUsers = {
                    'admin': {
                        password: 'admin123',
                        role: 'admin',
                        name: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®',
                        createdAt: new Date().toISOString()
                    },
                    'viewer': {
                        password: 'viewer123',
                        role: 'viewer',
                        name: '‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞',
                        createdAt: new Date().toISOString()
                    }
                };
                
                await db.collection('system').doc('users').set(defaultUsers);
                console.log('‚úÖ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } catch (error) {
                console.error('Error creating default users:', error);
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                // Get user data from Firestore
                const usersDoc = await db.collection('system').doc('users').get();
                const users = usersDoc.data();
                
                if (!users || !users[username]) {
                    document.getElementById('loginAlert').innerHTML = 
                        '<div class="alert alert-danger">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!</div>';
                    return;
                }
                
                const userData = users[username];
                
                if (userData.password !== password) {
                    document.getElementById('loginAlert').innerHTML = 
                        '<div class="alert alert-danger">‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!</div>';
                    return;
                }
                
                // Login successful
                currentUser = {
                    username: username,
                    role: userData.role,
                    name: userData.name
                };
                
                // Store login session
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('lastLogin', new Date().toISOString());
                
                showMainApp();
                
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('loginAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
            }
        }

        async function changeAdminPassword(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                document.getElementById('settingsAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!</div>';
                return;
            }
            
            if (newPassword.length < 6) {
                document.getElementById('settingsAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!</div>';
                return;
            }
            
            try {
                const usersDoc = await db.collection('system').doc('users').get();
                const users = usersDoc.data();
                const adminUsername = 'admin';
                
                if (!users[adminUsername] || users[adminUsername].password !== currentPassword) {
                    document.getElementById('settingsAlert').innerHTML = 
                        '<div class="alert alert-danger">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!</div>';
                    return;
                }
                
                // Update password in Firestore
                users[adminUsername].password = newPassword;
                users[adminUsername].updatedAt = new Date().toISOString();
                users[adminUsername].updatedBy = currentUser.username;
                
                await db.collection('system').doc('users').set(users);
                
                document.getElementById('settingsAlert').innerHTML = 
                    '<div class="alert alert-success">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶∏‡¶¨ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶π‡¶¨‡ßá‡•§</div>';
                
                // Reset form
                e.target.reset();
                document.getElementById('passwordStrength').className = 'password-strength';
                
            } catch (error) {
                console.error('Password change error:', error);
                document.getElementById('settingsAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
            }
        }

        async function changeViewerPassword(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentViewerPassword').value;
            const newPassword = document.getElementById('newViewerPassword').value;
            const confirmPassword = document.getElementById('confirmViewerPassword').value;
            
            if (newPassword !== confirmPassword) {
                document.getElementById('viewerAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!</div>';
                return;
            }
            
            if (newPassword.length < 6) {
                document.getElementById('viewerAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!</div>';
                return;
            }
            
            try {
                const usersDoc = await db.collection('system').doc('users').get();
                const users = usersDoc.data();
                const viewerUsername = 'viewer';
                
                if (!users[viewerUsername] || users[viewerUsername].password !== currentPassword) {
                    document.getElementById('viewerAlert').innerHTML = 
                        '<div class="alert alert-danger">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!</div>';
                    return;
                }
                
                // Update password in Firestore
                users[viewerUsername].password = newPassword;
                users[viewerUsername].updatedAt = new Date().toISOString();
                users[viewerUsername].updatedBy = currentUser.username;
                
                await db.collection('system').doc('users').set(users);
                
                document.getElementById('viewerAlert').innerHTML = 
                    '<div class="alert alert-success">‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶∏‡¶¨ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶π‡¶¨‡ßá‡•§</div>';
                
                // Reset form
                e.target.reset();
                document.getElementById('viewerPasswordStrength').className = 'password-strength';
                
            } catch (error) {
                console.error('Viewer password change error:', error);
                document.getElementById('viewerAlert').innerHTML = 
                    '<div class="alert alert-danger">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
            }
        }

        function checkPasswordStrength(password, type = 'admin') {
            const strengthBar = document.getElementById(type === 'admin' ? 'passwordStrength' : 'viewerPasswordStrength');
            
            if (!password) {
                strengthBar.className = 'password-strength';
                return;
            }
            
            let strength = 0;
            
            // Length check
            if (password.length >= 6) strength += 1;
            if (password.length >= 8) strength += 1;
            
            // Character variety checks
            if (/[a-z]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 1;
            
            if (strength <= 2) {
                strengthBar.className = 'password-strength strength-weak';
            } else if (strength <= 4) {
                strengthBar.className = 'password-strength strength-medium';
            } else {
                strengthBar.className = 'password-strength strength-strong';
            }
        }

        function logout() {
            if (confirm('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('lastLogin');
                currentUser = null;
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('loginAlert').innerHTML = '';
            }
        }

        // Existing Firebase Data Functions
        function syncDataToFirebase() {
            if (!currentUser || currentUser.role !== 'admin') return;
            
            const businessData = {
                transactions: transactions,
                materialTransactions: materialTransactions,
                partners: partners,
                employees: employees,
                materials: materials,
                lastUpdated: new Date().toISOString(),
                updatedBy: currentUser.name
            };
            
            db.collection('businessData').doc('mainData').set(businessData)
                .then(() => {
                    console.log('‚úÖ ‡¶°‡¶æ‡¶ü‡¶æ Firebase ‡¶è ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    showNotification('‚úÖ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                })
                .catch((error) => {
                    console.error('‚ùå Firebase Error:', error);
                    showNotification('‚ùå ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!');
                    isOnline = false;
                    updateConnectionStatus();
                });
        }

        function listenForDataChanges() {
            db.collection('businessData').doc('mainData')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        const previousTransactionsCount = transactions.length;
                        
                        transactions = data.transactions || [];
                        materialTransactions = data.materialTransactions || [];
                        partners = data.partners || [];
                        employees = data.employees || [];
                        materials = data.materials || [];
                        
                        // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                        renderTransactions();
                        renderMaterialTransactions();
                        renderPartners();
                        renderEmployees();
                        renderMaterials();
                        renderSalaryTransactions();
                        updateDashboard();
                        updateMonthlySummary();
                        updatePartnersDatalist();
                        updateMaterialsDatalist();
                        updateEmployeeSelect();
                        updateMaterialFilters();
                        updateFilters();
                        
                        // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶≤‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                        if (previousTransactionsCount !== transactions.length && currentUser.role === 'viewer') {
                            showNotification('üîÑ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                        }
                        
                        isOnline = true;
                        updateConnectionStatus();
                    }
                }, (error) => {
                    console.error('‚ùå Firebase Listen Error:', error);
                    isOnline = false;
                    updateConnectionStatus();
                });
        }

        function showNotification(message) {
            // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®
            const existingNotification = document.querySelector('.live-notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = 'live-notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                font-weight: bold;
                animation: slideIn 0.3s ease-out;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        function updateConnectionStatus() {
            let statusDiv = document.getElementById('connectionStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'connectionStatus';
                statusDiv.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 8px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: bold;
                    z-index: 1000;
                    color: white;
                `;
                document.body.appendChild(statusDiv);
            }
            
            if (isOnline) {
                statusDiv.textContent = 'üü¢ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®';
                statusDiv.style.background = '#28a745';
            } else {
                statusDiv.textContent = 'üî¥ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®';
                statusDiv.style.background = '#dc3545';
            }
        }

        // üéØ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° saveData ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function saveData() {
            const data = {
                transactions,
                materialTransactions,
                partners,
                employees,
                materials,
                lastUpdated: new Date().toISOString()
            };
            
            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡ßá‡¶≠
            localStorage.setItem('businessData', JSON.stringify(data));
            
            // Firebase ‡¶è ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï (‡¶Ø‡¶¶‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡ßü)
            syncDataToFirebase();
        }

        // üéØ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° loadData ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function loadData() {
            // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
            const saved = localStorage.getItem('businessData');
            if (saved) {
                const data = JSON.parse(saved);
                transactions = data.transactions || [];
                materialTransactions = data.materialTransactions || [];
                partners = data.partners || [];
                employees = data.employees || [];
                materials = data.materials || [];
            }
            
            // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®
            listenForDataChanges();
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserRole').textContent = currentUser.role === 'admin' ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : '‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞';
            
            applyPermissions();
            loadData();
            populateMonthDropdowns();
            updatePartnersDatalist();
            updateMaterialsDatalist();
            updateEmployeeSelect();
            updateMaterialFilters();
            updateFilters();
            setDefaultDate();
            renderTransactions();
            renderMaterialTransactions();
            renderPartners();
            renderEmployees();
            renderMaterials();
            renderSalaryTransactions();
            updateDashboard();
            updateMonthlySummary();
        }

        function applyPermissions() {
            const isAdmin = currentUser.role === 'admin';
            const isViewer = currentUser.role === 'viewer';
            
            // Show/hide elements based on role
            document.getElementById('txFormCard').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('materialTxFormCard').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('salaryFormCard').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('addPartnerBtn').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('employeesTab').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('salaryTab').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('backupTab').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('settingsTab').style.display = isAdmin ? 'block' : 'none';
            
            // Disable forms for viewer
            if (isViewer) {
                const forms = document.querySelectorAll('form');
                forms.forEach(form => {
                    form.querySelectorAll('input, select, textarea').forEach(field => {
                        field.disabled = true;
                    });
                });
            }
        }

        function setDefaultDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            document.getElementById('txDate').value = todayStr;
            document.getElementById('salaryDate').value = todayStr;
            document.getElementById('materialTxDate').value = todayStr;
            document.getElementById('txDate').max = todayStr;
            document.getElementById('salaryDate').max = todayStr;
            document.getElementById('materialTxDate').max = todayStr;
        }

        function populateMonthDropdowns() {
            const months = getAvailableMonths();
            const monthSelects = ['txMonth', 'salaryMonth', 'materialTxMonth', 'filterMonth', 'materialFilterMonth', 'dashboardMonthSelect'];
            
            monthSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = selectId === 'filterMonth' || selectId === 'materialFilterMonth' || selectId === 'dashboardMonthSelect' ? 
                    '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>' : '<option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
                
                months.forEach(month => {
                    const option = document.createElement('option');
                    option.value = month.value;
                    option.textContent = month.label;
                    select.appendChild(option);
                });
            });
        }

        function getAvailableMonths() {
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();
            const months = [];
            
            // ‡¶Æ‡¶æ‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            for (let year = currentYear - 3; year <= currentYear; year++) {
                const startMonth = (year === currentYear - 3) ? 0 : (year === currentYear) ? 0 : 0;
                const endMonth = (year === currentYear) ? currentMonth : 11;
                
                for (let month = startMonth; month <= endMonth; month++) {
                    const yearBn = year.toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
                    months.push({
                        value: `${monthNames[month]} ${yearBn}`,
                        label: `${monthNames[month]} ${yearBn}`
                    });
                }
            }
            
            // ‡¶Æ‡¶æ‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            return months.sort((a, b) => {
                const [aMonth, aYear] = a.value.split(' ');
                const [bMonth, bYear] = b.value.split(' ');
                
                const aYearNum = parseInt(aYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                const bYearNum = parseInt(bYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                
                if (aYearNum !== bYearNum) return aYearNum - bYearNum;
                
                const aMonthIndex = monthNames.indexOf(aMonth);
                const bMonthIndex = monthNames.indexOf(bMonth);
                return aMonthIndex - bMonthIndex;
            });
        }

        function updateMonthFromDate() {
            const dateInput = document.getElementById('txDate');
            const monthSelect = document.getElementById('txMonth');
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
                const monthName = monthNames[date.getMonth()];
                const monthValue = `${monthName} ${year}`;
                monthSelect.value = monthValue;
            }
        }

        function updateSalaryMonthFromDate() {
            const dateInput = document.getElementById('salaryDate');
            const monthSelect = document.getElementById('salaryMonth');
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
                const monthName = monthNames[date.getMonth()];
                const monthValue = `${monthName} ${year}`;
                monthSelect.value = monthValue;
            }
        }

        function updateMaterialMonthFromDate() {
            const dateInput = document.getElementById('materialTxDate');
            const monthSelect = document.getElementById('materialTxMonth');
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
                const monthName = monthNames[date.getMonth()];
                const monthValue = `${monthName} ${year}`;
                monthSelect.value = monthValue;
            }
        }

        function updatePartnersDatalist() {
            const datalist = document.getElementById('partnersList');
            datalist.innerHTML = '';
            partners.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.name;
                datalist.appendChild(option);
            });
        }

        function updateMaterialsDatalist() {
            const datalist = document.getElementById('materialsList');
            datalist.innerHTML = '';
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.name;
                datalist.appendChild(option);
            });
        }

        function updateEmployeeSelect() {
            const employeeSelect = document.getElementById('salaryEmployee');
            const txEmployeeSelect = document.getElementById('txEmployee');
            
            [employeeSelect, txEmployeeSelect].forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
                
                employees.forEach(employee => {
                    if (employee.status === 'active') {
                        const option = document.createElement('option');
                        option.value = employee.id;
                        option.textContent = `${employee.name} (${employee.position || '‡¶™‡¶¶‡¶¨‡¶ø ‡¶®‡ßá‡¶á'}) - ‡ß≥${employee.salary.toLocaleString('bn-BD')}`;
                        option.setAttribute('data-salary', employee.salary);
                        select.appendChild(option);
                    }
                });
                
                // ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                select.value = currentValue;
            });
            
            // ‡¶¨‡ßá‡¶§‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            updateSalaryInfo();
        }

        function updateMaterialFilters() {
            const materialFilter = document.getElementById('materialFilterName');
            materialFilter.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶≤</option>';
            
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.name;
                option.textContent = material.name;
                materialFilter.appendChild(option);
            });
        }

        function updateFilters() {
            const partnerFilter = document.getElementById('filterPartner');
            partnerFilter.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</option>';
            
            partners.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.name;
                option.textContent = partner.name;
                partnerFilter.appendChild(option);
            });
        }

        function toggleTransactionFields() {
            const type = document.getElementById('txType').value;
            const salaryEmployeeGroup = document.getElementById('salaryEmployeeGroup');
            
            // ‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶≤‡ßÅ‡¶ï‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡¶ø‡¶®
            salaryEmployeeGroup.style.display = 'none';
            
            if (type === 'salary') {
                // ‡¶¨‡ßá‡¶§‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                salaryEmployeeGroup.style.display = 'flex';
            }
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
        function toggleMaterialFields() {
            const type = document.getElementById('materialTxType').value;
            const priceGroup = document.getElementById('materialTxPriceGroup');
            
            if (type === 'material') {
                priceGroup.querySelector('label').innerHTML = '‡¶¶‡¶æ‡¶Æ <small style="color: #6c757d;">(‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)</small>';
                priceGroup.querySelector('input').required = false;
            } else if (type === 'purchase') {
                priceGroup.querySelector('label').innerHTML = '‡¶¶‡¶æ‡¶Æ *';
                priceGroup.querySelector('input').required = true;
            }
        }

        function resetMaterialForm() {
            document.getElementById('materialTxForm').reset();
            toggleMaterialFields();
        }

        // ‡¶¨‡ßá‡¶§‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ
        function updateSalaryInfo() {
            const employeeSelect = document.getElementById('salaryEmployee');
            const selectedOption = employeeSelect.options[employeeSelect.selectedIndex];
            const salaryAmount = selectedOption ? selectedOption.getAttribute('data-salary') || 0 : 0;
            
            document.getElementById('salaryAmount').value = salaryAmount;
            
            // ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶¨‡ßá‡¶§‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            updateRemainingSalary();
            
            updateSalaryTotal();
        }

        function updateRemainingSalary() {
            const employeeId = document.getElementById('salaryEmployee').value;
            if (!employeeId) return;
            
            const employee = employees.find(e => e.id == employeeId);
            if (!employee) return;
            
            // ‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡ßá‡¶§‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            const currentMonth = document.getElementById('salaryMonth').value;
            const salaryTransactions = transactions.filter(t => 
                t.type === 'salary' && 
                t.employeeId == employeeId && 
                t.month === currentMonth
            );
            
            const totalPaid = salaryTransactions.reduce((sum, t) => sum + t.amount, 0);
            const remaining = employee.salary - totalPaid;
            
            const remainingInfo = document.getElementById('remainingSalaryInfo');
            const remainingAmount = document.getElementById('remainingSalaryAmount');
            
            if (remaining > 0) {
                remainingInfo.style.display = 'block';
                remainingAmount.textContent = remaining.toLocaleString('bn-BD');
            } else {
                remainingInfo.style.display = 'none';
            }
        }

        function updateSalaryTotal() {
            const salaryAmount = parseFloat(document.getElementById('salaryAmount').value) || 0;
            const bonusAmount = parseFloat(document.getElementById('salaryBonus').value) || 0;
            const advanceAmount = parseFloat(document.getElementById('salaryAdvance').value) || 0;
            const totalAmount = salaryAmount + bonusAmount + advanceAmount;
            
            document.getElementById('salaryTotal').value = totalAmount;
        }

        function resetSalaryForm() {
            document.getElementById('salaryForm').reset();
            document.getElementById('salaryEmployee').value = '';
            document.getElementById('salaryAmount').value = '';
            document.getElementById('salaryBonus').value = '0';
            document.getElementById('salaryAdvance').value = '0';
            document.getElementById('salaryTotal').value = '';
            document.getElementById('salaryDescription').value = '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶¨‡ßá‡¶§‡¶®';
            document.getElementById('remainingSalaryInfo').style.display = 'none';
        }

        // Attachment Management Functions
        function previewAttachments() {
            const fileInput = document.getElementById('txAttachment');
            const previewContainer = document.getElementById('attachmentPreview');
            previewContainer.innerHTML = '';
            currentAttachments = [];
            
            if (fileInput.files.length > 5) {
                alert('‚ùå ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß´‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá!');
                fileInput.value = '';
                return;
            }
            
            Array.from(fileInput.files).forEach((file, index) => {
                const fileType = file.type.split('/')[0];
                const attachmentItem = document.createElement('div');
                attachmentItem.className = 'attachment-item';
                
                if (fileType === 'image') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.onclick = () => openImageModal(e.target.result);
                        attachmentItem.appendChild(img);
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-attachment';
                        removeBtn.innerHTML = '√ó';
                        removeBtn.onclick = () => removeAttachment(index);
                        attachmentItem.appendChild(removeBtn);
                    };
                    reader.readAsDataURL(file);
                } else {
                    const fileIcon = document.createElement('div');
                    fileIcon.className = 'file-icon';
                    fileIcon.innerHTML = getFileIcon(file.name);
                    attachmentItem.appendChild(fileIcon);
                    
                    const fileName = document.createElement('div');
                    fileName.style.cssText = 'position: absolute; bottom: 5px; left: 5px; right: 5px; font-size: 10px; background: rgba(0,0,0,0.7); color: white; padding: 2px; border-radius: 3px; text-align: center;';
                    fileName.textContent = file.name.length > 15 ? file.name.substring(0, 12) + '...' : file.name;
                    attachmentItem.appendChild(fileName);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-attachment';
                    removeBtn.innerHTML = '√ó';
                    removeBtn.onclick = () => removeAttachment(index);
                    attachmentItem.appendChild(removeBtn);
                }
                
                previewContainer.appendChild(attachmentItem);
                currentAttachments.push(file);
            });
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            switch(ext) {
                case 'pdf': return 'üìÑ';
                case 'doc': case 'docx': return 'üìù';
                case 'xls': case 'xlsx': return 'üìä';
                default: return 'üìé';
            }
        }

        function removeAttachment(index) {
            currentAttachments.splice(index, 1);
            previewAttachments();
        }

        function resetAttachmentForm() {
            document.getElementById('attachmentPreview').innerHTML = '';
            currentAttachments = [];
            document.getElementById('txAttachment').value = '';
        }

        function openImageModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModal').style.display = 'block';
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        async function uploadAttachments(transactionId) {
            if (currentAttachments.length === 0) return [];
            
            const uploadPromises = currentAttachments.map(async (file, index) => {
                const fileExtension = file.name.split('.').pop();
                const fileName = `attachments/${transactionId}_${Date.now()}_${index}.${fileExtension}`;
                const storageRef = storage.ref().child(fileName);
                
                // Progress tracking
                const uploadTask = storageRef.put(file);
                
                return new Promise((resolve, reject) => {
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            document.getElementById('uploadProgressBar').style.width = progress + '%';
                        },
                        (error) => {
                            reject(error);
                        },
                        async () => {
                            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                            resolve({
                                name: file.name,
                                url: downloadURL,
                                type: file.type,
                                size: file.size
                            });
                        }
                    );
                });
            });
            
            document.getElementById('uploadProgress').style.display = 'block';
            const results = await Promise.all(uploadPromises);
            document.getElementById('uploadProgress').style.display = 'none';
            
            return results;
        }

        async function deleteAttachments(attachments) {
            if (!attachments || attachments.length === 0) return;
            
            const deletePromises = attachments.map(async (attachment) => {
                try {
                    const storageRef = storage.refFromURL(attachment.url);
                    await storageRef.delete();
                } catch (error) {
                    console.error('Error deleting attachment:', error);
                }
            });
            
            await Promise.all(deletePromises);
        }

        // Modified addTransaction function (without material transactions)
        async function addTransaction(e) {
            e.preventDefault();
            
            const type = document.getElementById('txType').value;
            const transactionId = Date.now();
            
            // Upload attachments first
            let attachments = [];
            if (currentAttachments.length > 0) {
                try {
                    attachments = await uploadAttachments(transactionId);
                } catch (error) {
                    alert('‚ùå ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                    console.error('Upload error:', error);
                    return;
                }
            }
            
            const employeeId = document.getElementById('txEmployee').value;
            
            if (type === 'salary' && !employeeId) {
                alert('‚ùå ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const transaction = {
                id: transactionId,
                date: document.getElementById('txDate').value,
                month: document.getElementById('txMonth').value,
                type: type,
                amount: parseFloat(document.getElementById('txAmount').value),
                partner: document.getElementById('txPartner').value,
                description: document.getElementById('txDescription').value,
                employeeId: employeeId,
                attachments: attachments,
                createdAt: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveData();
            e.target.reset();
            setDefaultDate();
            toggleTransactionFields();
            resetAttachmentForm();
            
            alert('‚úÖ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° addMaterialTransaction ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function addMaterialTransaction(e) {
            e.preventDefault();
            
            const type = document.getElementById('materialTxType').value;
            const materialName = document.getElementById('materialTxName').value;
            const materialQuantity = parseFloat(document.getElementById('materialTxQuantity').value) || 0;
            const materialUnit = document.getElementById('materialTxUnit').value;
            const materialPrice = parseFloat(document.getElementById('materialTxPrice').value) || 0;
            const supplier = document.getElementById('materialTxSupplier').value;
            const memo = document.getElementById('materialTxMemo').value;
            const project = document.getElementById('materialTxProject').value;
            
            if (!materialName || materialQuantity <= 0) {
                alert('‚ùå ‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            if (type === 'purchase' && materialPrice <= 0) {
                alert('‚ùå ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¶‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                date: document.getElementById('materialTxDate').value,
                month: document.getElementById('materialTxMonth').value,
                type: type,
                amount: materialPrice,
                materialName: materialName,
                materialQuantity: materialQuantity,
                materialUnit: materialUnit,
                supplier: supplier,
                memo: memo,
                project: project,
                description: document.getElementById('materialTxDescription').value,
                createdAt: new Date().toISOString()
            };
            
            materialTransactions.push(transaction);
            
            // ‡¶Æ‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            updateMaterialStock(transaction);
            
            saveData();
            e.target.reset();
            setDefaultDate();
            toggleMaterialFields();
            
            alert('‚úÖ ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° paySalary ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function paySalary(e) {
            e.preventDefault();
            
            const employeeId = document.getElementById('salaryEmployee').value;
            const salaryAmount = parseFloat(document.getElementById('salaryAmount').value) || 0;
            const bonusAmount = parseFloat(document.getElementById('salaryBonus').value) || 0;
            const advanceAmount = parseFloat(document.getElementById('salaryAdvance').value) || 0;
            const totalAmount = parseFloat(document.getElementById('salaryTotal').value) || 0;
            const date = document.getElementById('salaryDate').value;
            const month = document.getElementById('salaryMonth').value;
            const description = document.getElementById('salaryDescription').value;
            
            if (!employeeId || totalAmount <= 0) {
                alert('‚ùå ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßá‡¶§‡¶® ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const employee = employees.find(e => e.id == employeeId);
            if (!employee) {
                alert('‚ùå ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                date: date,
                month: month,
                type: 'salary',
                amount: totalAmount,
                partner: '',
                description: `${description} - ${employee.name}`,
                employeeId: employeeId,
                salaryAmount: salaryAmount,
                bonusAmount: bonusAmount,
                advanceAmount: advanceAmount,
                isAdvance: false,
                createdAt: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveData();
            e.target.reset();
            setDefaultDate();
            resetSalaryForm();
            
            alert('‚úÖ ‡¶¨‡ßá‡¶§‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶¨‡ßá‡¶§‡¶® ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function payAdvanceSalary() {
            const employeeId = document.getElementById('salaryEmployee').value;
            const advanceAmount = parseFloat(document.getElementById('salaryAdvance').value) || 0;
            const date = document.getElementById('salaryDate').value;
            const month = document.getElementById('salaryMonth').value;
            
            if (!employeeId || advanceAmount <= 0) {
                alert('‚ùå ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶¨‡ßá‡¶§‡¶® ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const employee = employees.find(e => e.id == employeeId);
            if (!employee) {
                alert('‚ùå ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                date: date,
                month: month,
                type: 'salary',
                amount: advanceAmount,
                partner: '',
                description: `‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶¨‡ßá‡¶§‡¶® - ${employee.name}`,
                employeeId: employeeId,
                salaryAmount: 0,
                bonusAmount: 0,
                advanceAmount: advanceAmount,
                isAdvance: true,
                createdAt: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveData();
            
            // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            document.getElementById('salaryAdvance').value = '0';
            updateSalaryTotal();
            updateRemainingSalary();
            
            alert('‚úÖ ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ ‡¶¨‡ßá‡¶§‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        function updateMaterialStock(transaction) {
            let material = materials.find(m => m.name === transaction.materialName);
            
            if (!material) {
                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
                material = {
                    id: materials.length > 0 ? Math.max(...materials.map(m => m.id)) + 1 : 1,
                    name: transaction.materialName,
                    unit: transaction.materialUnit,
                    stock: 0,
                    alertLevel: 0,
                    status: 'active'
                };
                materials.push(material);
            }
            
            if (transaction.type === 'purchase') {
                material.stock += transaction.materialQuantity;
            } else if (transaction.type === 'material') {
                material.stock -= transaction.materialQuantity;
            }
            
            // ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
            if (material.alertLevel > 0 && material.stock <= material.alertLevel) {
                showNotification(`‚ö†Ô∏è ${material.name} ‡¶è‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ‡ßá ‡¶ó‡ßá‡¶õ‡ßá! ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®: ${material.stock} ${material.unit}`);
            }
        }

        // Modified deleteTransaction function to handle attachments
        async function deleteTransaction(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                const transaction = transactions.find(t => t.id === id);
                
                // Delete attachments from storage
                if (transaction.attachments && transaction.attachments.length > 0) {
                    await deleteAttachments(transaction.attachments);
                }
                
                transactions = transactions.filter(t => t.id !== id);
                saveData();
            }
        }

        // ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Æ‡ßÅ‡¶õ‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function deleteMaterialTransaction(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                const transaction = materialTransactions.find(t => t.id === id);
                
                // ‡¶Ø‡¶¶‡¶ø ‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶¨‡¶æ ‡¶ñ‡¶∞‡¶ö ‡¶π‡¶Ø‡¶º, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∞‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®
                if (transaction && (transaction.type === 'purchase' || transaction.type === 'material')) {
                    reverseMaterialStock(transaction);
                }
                
                materialTransactions = materialTransactions.filter(t => t.id !== id);
                saveData();
            }
        }

        function reverseMaterialStock(transaction) {
            const material = materials.find(m => m.name === transaction.materialName);
            if (material) {
                if (transaction.type === 'purchase') {
                    material.stock -= transaction.materialQuantity;
                } else if (transaction.type === 'material') {
                    material.stock += transaction.materialQuantity;
                }
            }
        }

        // Modified renderTransactions function (without material transactions)
        function renderTransactions() {
            const tbody = document.getElementById('transactionsBody');
            const filterMonth = document.getElementById('filterMonth').value;
            const filterType = document.getElementById('filterType').value;
            const filterPartner = document.getElementById('filterPartner').value;
            
            let filtered = transactions;
            
            if (filterMonth !== 'all') {
                filtered = filtered.filter(t => t.month === filterMonth);
            }
            
            if (filterType !== 'all') {
                filtered = filtered.filter(t => t.type === filterType);
            }
            
            if (filterPartner !== 'all') {
                filtered = filtered.filter(t => t.partner === filterPartner);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">‡¶ï‡ßã‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>`;
                return;
            }
            
            tbody.innerHTML = filtered.map(transaction => {
                let badgeClass = '';
                let typeText = '';
                
                switch(transaction.type) {
                    case 'income':
                        badgeClass = 'badge-income';
                        typeText = '‡¶ú‡¶Æ‡¶æ';
                        break;
                    case 'expense':
                        badgeClass = 'badge-expense';
                        typeText = '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º';
                        break;
                    case 'salary':
                        badgeClass = 'badge-salary';
                        typeText = '‡¶¨‡ßá‡¶§‡¶®';
                        break;
                }
                
                const employee = transaction.employeeId ? employees.find(e => e.id == transaction.employeeId) : null;
                const employeeName = employee ? employee.name : '-';
                
                const attachmentsHtml = transaction.attachments && transaction.attachments.length > 0 
                    ? transaction.attachments.map((att, index) => {
                        const isImage = att.type.startsWith('image/');
                        return `
                            <div style="margin-bottom: 5px;">
                                <a href="${att.url}" target="_blank" style="text-decoration: none; color: #007bff; font-size: 12px;">
                                    ${isImage ? 'üñºÔ∏è' : getFileIcon(att.name)} ${att.name}
                                </a>
                            </div>
                        `;
                    }).join('')
                    : '-';
                
                return `
                <tr>
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.month}</td>
                    <td><span class="badge ${badgeClass}">${typeText}</span></td>
                    <td style="font-weight: bold; color: ${transaction.type === 'income' ? '#28a745' : '#dc3545'}">‡ß≥ ${transaction.amount.toLocaleString('bn-BD')}</td>
                    <td>${employeeName}</td>
                    <td>${transaction.partner || '-'}</td>
                    <td>${transaction.description}</td>
                    <td style="max-width: 150px;">${attachmentsHtml}</td>
                    <td>
                        ${currentUser.role === 'admin' ? `
                            <button class="btn btn-danger btn-sm" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                        ` : ''}
                    </td>
                </tr>
                `;
            }).join('');
        }

        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° renderMaterialTransactions ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function renderMaterialTransactions() {
            const tbody = document.getElementById('materialTransactionsBody');
            const filterMonth = document.getElementById('materialFilterMonth').value;
            const filterType = document.getElementById('materialFilterType').value;
            const filterName = document.getElementById('materialFilterName').value;
            
            let filtered = materialTransactions;
            
            if (filterMonth !== 'all') {
                filtered = filtered.filter(t => t.month === filterMonth);
            }
            
            if (filterType !== 'all') {
                filtered = filtered.filter(t => t.type === filterType);
            }
            
            if (filterName !== 'all') {
                filtered = filtered.filter(t => t.materialName === filterName);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="12" style="text-align: center; padding: 40px; color: #6c757d;">‡¶ï‡ßã‡¶® ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>`;
                return;
            }
            
            tbody.innerHTML = filtered.map(transaction => {
                let badgeClass = '';
                let typeText = '';
                
                switch(transaction.type) {
                    case 'purchase':
                        badgeClass = 'badge-purchase';
                        typeText = '‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º';
                        break;
                    case 'material':
                        badgeClass = 'badge-material';
                        typeText = '‡¶Æ‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö';
                        break;
                }
                
                return `
                <tr>
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.month}</td>
                    <td><span class="badge ${badgeClass}">${typeText}</span></td>
                    <td>${transaction.materialName}</td>
                    <td>${transaction.materialQuantity}</td>
                    <td>${transaction.materialUnit || '-'}</td>
                    <td>${transaction.supplier || '-'}</td>
                    <td>${transaction.memo || '-'}</td>
                    <td>${transaction.project || '-'}</td>
                    <td style="font-weight: bold; color: ${transaction.type === 'purchase' ? '#007bff' : '#ffc107'}">${transaction.amount > 0 ? '‡ß≥ ' + transaction.amount.toLocaleString('bn-BD') : '-'}</td>
                    <td>${transaction.description}</td>
                    <td>
                        ${currentUser.role === 'admin' ? `
                            <button class="btn btn-danger btn-sm" onclick="deleteMaterialTransaction(${transaction.id})">üóëÔ∏è</button>
                        ` : ''}
                    </td>
                </tr>
                `;
            }).join('');
        }

        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° renderSalaryTransactions ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function renderSalaryTransactions() {
            const tbody = document.getElementById('salaryTransactionsBody');
            const salaryTransactions = transactions.filter(t => t.type === 'salary');
            
            if (salaryTransactions.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">‡¶ï‡ßã‡¶® ‡¶¨‡ßá‡¶§‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>`;
                return;
            }
            
            tbody.innerHTML = salaryTransactions.map(transaction => {
                const employee = employees.find(e => e.id == transaction.employeeId);
                const employeeName = employee ? employee.name : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ';
                const isAdvance = transaction.isAdvance ? '<span class="badge badge-advance">‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ</span>' : '';
                
                return `
                <tr>
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.month}</td>
                    <td>${employeeName} ${isAdvance}</td>
                    <td>‡ß≥ ${(transaction.salaryAmount || 0).toLocaleString('bn-BD')}</td>
                    <td>‡ß≥ ${(transaction.bonusAmount || 0).toLocaleString('bn-BD')}</td>
                    <td>‡ß≥ ${(transaction.advanceAmount || 0).toLocaleString('bn-BD')}</td>
                    <td style="font-weight: bold;">‡ß≥ ${transaction.amount.toLocaleString('bn-BD')}</td>
                    <td>${transaction.description}</td>
                    <td>
                        ${currentUser.role === 'admin' ? `
                            <button class="btn btn-danger btn-sm" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                        ` : ''}
                    </td>
                </tr>
                `;
            }).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const day = date.getDate().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            const month = (date.getMonth() + 1).toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            return `${day}/${month}/${year}`;
        }

        function updateDashboard() {
            const selectedMonth = document.getElementById('dashboardMonthSelect').value;
            let filteredTransactions = transactions;
            let filteredMaterialTransactions = materialTransactions;
            
            if (selectedMonth !== 'all') {
                filteredTransactions = transactions.filter(t => t.month === selectedMonth);
                filteredMaterialTransactions = materialTransactions.filter(t => t.month === selectedMonth);
            }
            
            const totalIncome = filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const totalSalary = filteredTransactions.filter(t => t.type === 'salary').reduce((sum, t) => sum + t.amount, 0);
            const totalPurchase = filteredMaterialTransactions.filter(t => t.type === 'purchase').reduce((sum, t) => sum + t.amount, 0);
            const netProfit = totalIncome - totalExpense - totalSalary - totalPurchase;
            
            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString('bn-BD');
            document.getElementById('totalExpense').textContent = totalExpense.toLocaleString('bn-BD');
            document.getElementById('totalPurchase').textContent = totalPurchase.toLocaleString('bn-BD');
            document.getElementById('netProfit').textContent = netProfit.toLocaleString('bn-BD');
            
            updateCharts(filteredTransactions, filteredMaterialTransactions);
        }

        function updateCharts(filteredTransactions, filteredMaterialTransactions) {
            // Daily Chart
            const dailyData = {};
            
            // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            filteredTransactions.forEach(t => {
                if (!dailyData[t.date]) {
                    dailyData[t.date] = { income: 0, expense: 0, salary: 0 };
                }
                if (t.type === 'income') {
                    dailyData[t.date].income += t.amount;
                } else if (t.type === 'expense') {
                    dailyData[t.date].expense += t.amount;
                } else if (t.type === 'salary') {
                    dailyData[t.date].salary += t.amount;
                }
            });
            
            // ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            filteredMaterialTransactions.forEach(t => {
                if (!dailyData[t.date]) {
                    dailyData[t.date] = { income: 0, expense: 0, salary: 0, purchase: 0 };
                }
                if (t.type === 'purchase') {
                    dailyData[t.date].purchase += t.amount;
                }
            });
            
            const dates = Object.keys(dailyData).sort();
            const incomeData = dates.map(date => dailyData[date].income || 0);
            const expenseData = dates.map(date => dailyData[date].expense || 0);
            const salaryData = dates.map(date => dailyData[date].salary || 0);
            const purchaseData = dates.map(date => dailyData[date].purchase || 0);
            
            const dailyCtx = document.getElementById('dailyChart').getContext('2d');
            if (dailyChart) dailyChart.destroy();
            
            dailyChart = new Chart(dailyCtx, {
                type: 'line',
                data: {
                    labels: dates.map(d => formatDate(d)),
                    datasets: [
                        {
                            label: '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º',
                            data: incomeData,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö',
                            data: expenseData,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '‡¶¨‡ßá‡¶§‡¶®',
                            data: salaryData,
                            borderColor: '#6c757d',
                            backgroundColor: 'rgba(108, 117, 125, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º',
                            data: purchaseData,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‡ß≥ ' + value.toLocaleString('bn-BD');
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly Chart
            const monthlyData = {};
            
            // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            transactions.forEach(t => {
                if (!monthlyData[t.month]) {
                    monthlyData[t.month] = { income: 0, expense: 0, salary: 0 };
                }
                if (t.type === 'income') {
                    monthlyData[t.month].income += t.amount;
                } else if (t.type === 'expense') {
                    monthlyData[t.month].expense += t.amount;
                } else if (t.type === 'salary') {
                    monthlyData[t.month].salary += t.amount;
                }
            });
            
            // ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            materialTransactions.forEach(t => {
                if (!monthlyData[t.month]) {
                    monthlyData[t.month] = { income: 0, expense: 0, salary: 0, purchase: 0 };
                }
                if (t.type === 'purchase') {
                    monthlyData[t.month].purchase += t.amount;
                }
            });
            
            // ‡¶Æ‡¶æ‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            const months = Object.keys(monthlyData).sort((a, b) => {
                const [aMonth, aYear] = a.split(' ');
                const [bMonth, bYear] = b.split(' ');
                
                const aYearNum = parseInt(aYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                const bYearNum = parseInt(bYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                
                if (aYearNum !== bYearNum) return aYearNum - bYearNum;
                
                const aMonthIndex = monthNames.indexOf(aMonth);
                const bMonthIndex = monthNames.indexOf(bMonth);
                return aMonthIndex - bMonthIndex;
            });
            
            const monthlyIncome = months.map(month => monthlyData[month].income);
            const monthlyExpense = months.map(month => monthlyData[month].expense);
            const monthlySalary = months.map(month => monthlyData[month].salary);
            const monthlyPurchase = months.map(month => monthlyData[month].purchase);
            
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            if (monthlyChart) monthlyChart.destroy();
            
            monthlyChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º',
                            data: monthlyIncome,
                            backgroundColor: '#28a745',
                            borderColor: '#28a745',
                            borderWidth: 1
                        },
                        {
                            label: '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö',
                            data: monthlyExpense,
                            backgroundColor: '#dc3545',
                            borderColor: '#dc3545',
                            borderWidth: 1
                        },
                        {
                            label: '‡¶¨‡ßá‡¶§‡¶®',
                            data: monthlySalary,
                            backgroundColor: '#6c757d',
                            borderColor: '#6c757d',
                            borderWidth: 1
                        },
                        {
                            label: '‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º',
                            data: monthlyPurchase,
                            backgroundColor: '#007bff',
                            borderColor: '#007bff',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: '‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‡ß≥ ' + value.toLocaleString('bn-BD');
                                }
                            }
                        }
                    }
                }
            });
        }

        // ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® - ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶ø‡¶§
        function updateMonthlySummary() {
            const monthlyData = {};
            
            // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            transactions.forEach(t => {
                if (!monthlyData[t.month]) {
                    monthlyData[t.month] = { income: 0, expense: 0, salary: 0, purchase: 0 };
                }
                monthlyData[t.month].income += t.type === 'income' ? t.amount : 0;
                monthlyData[t.month].expense += t.type === 'expense' ? t.amount : 0;
                monthlyData[t.month].salary += t.type === 'salary' ? t.amount : 0;
            });
            
            // ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            materialTransactions.forEach(t => {
                if (!monthlyData[t.month]) {
                    monthlyData[t.month] = { income: 0, expense: 0, salary: 0, purchase: 0 };
                }
                monthlyData[t.month].purchase += t.type === 'purchase' ? t.amount : 0;
            });
            
            const container = document.getElementById('monthlySummary');
            
            if (Object.keys(monthlyData).length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><h3>‡¶ï‡ßã‡¶® ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á</h3><p>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            // ‡¶Æ‡¶æ‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            const sortedMonths = Object.keys(monthlyData).sort((a, b) => {
                const [aMonth, aYear] = a.split(' ');
                const [bMonth, bYear] = b.split(' ');
                
                const aYearNum = parseInt(aYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                const bYearNum = parseInt(bYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                
                if (aYearNum !== bYearNum) return aYearNum - bYearNum;
                
                const aMonthIndex = monthNames.indexOf(aMonth);
                const bMonthIndex = monthNames.indexOf(bMonth);
                return aMonthIndex - bMonthIndex;
            });
            
            let html = '<div class="monthly-summary-grid">';
            
            sortedMonths.forEach(month => {
                const data = monthlyData[month];
                const profit = data.income - data.expense - data.salary - data.purchase;
                
                html += `
                <div class="monthly-card">
                    <h3>${month}</h3>
                    <div class="monthly-stats">
                        <div class="monthly-stat income">
                            <label>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</label>
                            <div class="value">‡ß≥ ${data.income.toLocaleString('bn-BD')}</div>
                        </div>
                        <div class="monthly-stat expense">
                            <label>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</label>
                            <div class="value">‡ß≥ ${data.expense.toLocaleString('bn-BD')}</div>
                        </div>
                        <div class="monthly-stat purchase">
                            <label>‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</label>
                            <div class="value">‡ß≥ ${data.purchase.toLocaleString('bn-BD')}</div>
                        </div>
                        <div class="monthly-stat salary">
                            <label>‡¶¨‡ßá‡¶§‡¶®</label>
                            <div class="value">‡ß≥ ${data.salary.toLocaleString('bn-BD')}</div>
                        </div>
                        <div class="monthly-stat" style="grid-column: 1 / -1;">
                            <label>‡¶®‡¶ø‡¶ü ‡¶≤‡¶æ‡¶≠/‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®</label>
                            <div class="value" style="color: ${profit >= 0 ? '#28a745' : '#dc3545'}">‡ß≥ ${Math.abs(profit).toLocaleString('bn-BD')}</div>
                        </div>
                    </div>
                </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶ø‡¶§ exportMonthlyData ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function exportMonthlyData() {
            const monthlyData = {};
            
            // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            transactions.forEach(t => {
                if (!monthlyData[t.month]) {
                    monthlyData[t.month] = { income: 0, expense: 0, salary: 0, transactions: [] };
                }
                monthlyData[t.month].income += t.type === 'income' ? t.amount : 0;
                monthlyData[t.month].expense += t.type === 'expense' ? t.amount : 0;
                monthlyData[t.month].salary += t.type === 'salary' ? t.amount : 0;
                monthlyData[t.month].transactions.push(t);
            });
            
            // ‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            materialTransactions.forEach(t => {
                if (!monthlyData[t.month]) {
                    monthlyData[t.month] = { income: 0, expense: 0, salary: 0, purchase: 0, transactions: [] };
                }
                monthlyData[t.month].purchase += t.type === 'purchase' ? t.amount : 0;
                monthlyData[t.month].transactions.push(t);
            });
            
            let html = '<div style="font-family: Arial, sans-serif;">';
            html += '<h2 style="text-align: center; color: #667eea;">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>';
            
            // ‡¶Æ‡¶æ‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            const sortedMonths = Object.keys(monthlyData).sort((a, b) => {
                const [aMonth, aYear] = a.split(' ');
                const [bMonth, bYear] = b.split(' ');
                
                const aYearNum = parseInt(aYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                const bYearNum = parseInt(bYear.replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'.indexOf(d)));
                
                if (aYearNum !== bYearNum) return aYearNum - bYearNum;
                
                const aMonthIndex = monthNames.indexOf(aMonth);
                const bMonthIndex = monthNames.indexOf(bMonth);
                return aMonthIndex - bMonthIndex;
            });
            
            sortedMonths.forEach(month => {
                const data = monthlyData[month];
                const profit = data.income - data.expense - data.salary - data.purchase;
                
                html += `<div style="margin-bottom: 30px; border: 2px solid #667eea; border-radius: 10px; padding: 20px;">`;
                html += `<h3 style="color: #667eea; border-bottom: 2px solid #dee2e6; padding-bottom: 10px;">${month}</h3>`;
                html += `<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">`;
                html += `<div style="background: #d4edda; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º:</strong><br>‡ß≥ ${data.income.toLocaleString('bn-BD')}</div>`;
                html += `<div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º:</strong><br>‡ß≥ ${data.expense.toLocaleString('bn-BD')}</div>`;
                html += `<div style="background: #cce7ff; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º:</strong><br>‡ß≥ ${data.purchase.toLocaleString('bn-BD')}</div>`;
                html += `<div style="background: #e2e3e5; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶¨‡ßá‡¶§‡¶®:</strong><br>‡ß≥ ${data.salary.toLocaleString('bn-BD')}</div>`;
                html += `<div style="background: ${profit >= 0 ? '#d4edda' : '#f8d7da'}; padding: 15px; border-radius: 8px; text-align: center; grid-column: 1 / -1;"><strong>‡¶≤‡¶æ‡¶≠/‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®:</strong><br>‡ß≥ ${Math.abs(profit).toLocaleString('bn-BD')} (${profit >= 0 ? '‡¶≤‡¶æ‡¶≠' : '‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®'})</div>`;
                html += `</div>`;
                
                html += `<h4 style="margin-bottom: 10px;">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶Æ‡ßÇ‡¶π:</h4>`;
                html += `<table style="width: 100%; border-collapse: collapse;">`;
                html += `<tr style="background: #667eea; color: white;"><th style="padding: 10px; text-align: left;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th style="padding: 10px; text-align: left;">‡¶ß‡¶∞‡¶®</th><th style="padding: 10px; text-align: left;">‡¶ü‡¶æ‡¶ï‡¶æ</th><th style="padding: 10px; text-align: left;">‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th style="padding: 10px; text-align: left;">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ</th><th style="padding: 10px; text-align: left;">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th></tr>`;
                
                data.transactions.forEach(t => {
                    let badgeColor = '';
                    let typeText = '';
                    
                    switch(t.type) {
                        case 'income':
                            badgeColor = '#d4edda';
                            typeText = '‡¶ú‡¶Æ‡¶æ';
                            break;
                        case 'expense':
                            badgeColor = '#f8d7da';
                            typeText = '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º';
                            break;
                        case 'salary':
                            badgeColor = '#e2e3e5';
                            typeText = '‡¶¨‡ßá‡¶§‡¶®';
                            break;
                        case 'purchase':
                            badgeColor = '#cce7ff';
                            typeText = '‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º';
                            break;
                        case 'material':
                            badgeColor = '#fff3cd';
                            typeText = '‡¶Æ‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö';
                            break;
                    }
                    
                    const employee = t.employeeId ? employees.find(e => e.id == t.employeeId) : null;
                    const employeeName = employee ? employee.name : '-';
                    
                    html += `<tr style="border-bottom: 1px solid #dee2e6;">`;
                    html += `<td style="padding: 8px 10px;">${formatDate(t.date)}</td>`;
                    html += `<td style="padding: 8px 10px;"><span style="padding: 4px 8px; border-radius: 4px; background: ${badgeColor};">${typeText}</span></td>`;
                    html += `<td style="padding: 8px 10px; font-weight: bold; color: ${t.type === 'income' ? '#28a745' : '#dc3545'};">‡ß≥ ${t.amount.toLocaleString('bn-BD')}</td>`;
                    html += `<td style="padding: 8px 10px;">${t.materialName || '-'}</td>`;
                    html += `<td style="padding: 8px 10px;">${employeeName}</td>`;
                    html += `<td style="padding: 8px 10px;">${t.description}</td>`;
                    html += `</tr>`;
                });
                
                html += `</table>`;
                html += `</div>`;
            });
            
            html += '</div>';
            
            const win = window.open('', '_blank');
            win.document.write(html);
            win.document.close();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'monthly') {
                updateMonthlySummary(); // ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            } else if (tabName === 'materials') {
                renderMaterialTransactions();
                renderMaterials();
            } else if (tabName === 'partners') {
                renderPartners();
            } else if (tabName === 'employees') {
                renderEmployees();
            } else if (tabName === 'salary') {
                renderSalaryTransactions();
            } else if (tabName === 'transactions') {
                renderTransactions();
            }
        }

        // Partner Management Functions
        function showAddPartnerModal() {
            document.getElementById('partnerModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó';
            document.getElementById('partnerEditId').value = '';
            document.getElementById('partnerName').value = '';
            document.getElementById('partnerPhone').value = '';
            document.getElementById('partnerStatus').value = 'active';
            document.getElementById('partnerModal').style.display = 'block';
        }

        function showEditPartnerModal(id) {
            const partner = partners.find(p => p.id == id);
            if (partner) {
                document.getElementById('partnerModalTitle').textContent = '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
                document.getElementById('partnerEditId').value = partner.id;
                document.getElementById('partnerName').value = partner.name;
                document.getElementById('partnerPhone').value = partner.phone;
                document.getElementById('partnerStatus').value = partner.status;
                document.getElementById('partnerModal').style.display = 'block';
            }
        }

        function closePartnerModal() {
            document.getElementById('partnerModal').style.display = 'none';
        }

        function savePartner(e) {
            e.preventDefault();
            
            const id = document.getElementById('partnerEditId').value;
            const name = document.getElementById('partnerName').value;
            const phone = document.getElementById('partnerPhone').value;
            const status = document.getElementById('partnerStatus').value;
            
            if (id) {
                // Edit existing partner
                const partner = partners.find(p => p.id == id);
                if (partner) {
                    partner.name = name;
                    partner.phone = phone;
                    partner.status = status;
                }
            } else {
                // Add new partner
                const newId = partners.length > 0 ? Math.max(...partners.map(p => p.id)) + 1 : 1;
                partners.push({
                    id: newId,
                    name,
                    phone,
                    status
                });
            }
            
            saveData();
            renderPartners();
            updatePartnersDatalist();
            updateFilters();
            closePartnerModal();
            
            alert('‚úÖ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        function renderPartners() {
            const container = document.getElementById('partnersReport');
            
            if (partners.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><h3>‡¶ï‡ßã‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = partners.map(partner => {
                const partnerTransactions = transactions.filter(t => t.partner === partner.name);
                const totalIncome = partnerTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const totalExpense = partnerTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const netAmount = totalIncome - totalExpense;
                
                return `
                    <div class="partner-card">
                        <div class="partner-header">
                            <div class="partner-avatar">${partner.name.charAt(0)}</div>
                            <div class="partner-info">
                                <h3>${partner.name} <span class="status-badge ${partner.status === 'active' ? 'status-active' : 'status-inactive'}">${partner.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'}</span></h3>
                                <p>üìû ${partner.phone || '‡¶®‡ßá‡¶á'}</p>
                            </div>
                        </div>
                        <div class="partner-stats">
                            <div class="partner-stat income">
                                <label>‡¶ú‡¶Æ‡¶æ</label>
                                <div class="value">‡ß≥ ${totalIncome.toLocaleString('bn-BD')}</div>
                            </div>
                            <div class="partner-stat expense">
                                <label>‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</label>
                                <div class="value">‡ß≥ ${totalExpense.toLocaleString('bn-BD')}</div>
                            </div>
                            <div class="partner-stat" style="grid-column: 1 / -1;">
                                <label>‡¶®‡¶ø‡¶ü</label>
                                <div class="value" style="color: ${netAmount >= 0 ? '#28a745' : '#dc3545'}">‡ß≥ ${Math.abs(netAmount).toLocaleString('bn-BD')}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="showEditPartnerModal(${partner.id})" ${currentUser.role === 'viewer' ? 'disabled' : ''}>‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-danger btn-sm" onclick="deletePartner(${partner.id})" ${currentUser.role === 'viewer' ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deletePartner(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                partners = partners.filter(p => p.id !== id);
                saveData();
                renderPartners();
                updatePartnersDatalist();
                updateFilters();
            }
        }

        // Material Management Functions
        function showAddMaterialModal() {
            document.getElementById('materialModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶≤ ‡¶Ø‡ßã‡¶ó';
            document.getElementById('materialEditId').value = '';
            document.getElementById('materialName').value = '';
            document.getElementById('materialUnit').value = '';
            document.getElementById('materialStock').value = '';
            document.getElementById('materialAlertLevel').value = '';
            document.getElementById('materialStatus').value = 'active';
            document.getElementById('materialModal').style.display = 'block';
        }

        function showEditMaterialModal(id) {
            const material = materials.find(m => m.id == id);
            if (material) {
                document.getElementById('materialModalTitle').textContent = '‡¶Æ‡¶æ‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
                document.getElementById('materialEditId').value = material.id;
                document.getElementById('materialName').value = material.name;
                document.getElementById('materialUnit').value = material.unit;
                document.getElementById('materialStock').value = material.stock;
                document.getElementById('materialAlertLevel').value = material.alertLevel;
                document.getElementById('materialStatus').value = material.status;
                document.getElementById('materialModal').style.display = 'block';
            }
        }

        function closeMaterialModal() {
            document.getElementById('materialModal').style.display = 'none';
        }

        function saveMaterial(e) {
            e.preventDefault();
            
            const id = document.getElementById('materialEditId').value;
            const name = document.getElementById('materialName').value;
            const unit = document.getElementById('materialUnit').value;
            const stock = parseFloat(document.getElementById('materialStock').value) || 0;
            const alertLevel = parseFloat(document.getElementById('materialAlertLevel').value) || 0;
            const status = document.getElementById('materialStatus').value;
            
            if (id) {
                // Edit existing material
                const material = materials.find(m => m.id == id);
                if (material) {
                    material.name = name;
                    material.unit = unit;
                    material.stock = stock;
                    material.alertLevel = alertLevel;
                    material.status = status;
                }
            } else {
                // Add new material
                const newId = materials.length > 0 ? Math.max(...materials.map(m => m.id)) + 1 : 1;
                materials.push({
                    id: newId,
                    name,
                    unit,
                    stock,
                    alertLevel,
                    status
                });
            }
            
            saveData();
            renderMaterials();
            updateMaterialsDatalist();
            updateMaterialFilters();
            closeMaterialModal();
            
            alert('‚úÖ ‡¶Æ‡¶æ‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        function renderMaterials() {
            const container = document.getElementById('materialsGrid');
            
            if (materials.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>‡¶ï‡ßã‡¶® ‡¶Æ‡¶æ‡¶≤ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = materials.map(material => {
                const materialTx = materialTransactions.filter(t => t.materialName === material.name);
                const totalPurchase = materialTx.filter(t => t.type === 'purchase').reduce((sum, t) => sum + t.amount, 0);
                const totalMaterial = materialTx.filter(t => t.type === 'material').reduce((sum, t) => sum + t.materialQuantity, 0);
                
                const stockClass = material.alertLevel > 0 && material.stock <= material.alertLevel ? 'stock-low' : 'stock-ok';
                
                return `
                    <div class="material-card">
                        <div class="partner-header">
                            <div class="partner-avatar">${material.name.charAt(0)}</div>
                            <div class="partner-info">
                                <h3>${material.name} <span class="status-badge ${material.status === 'active' ? 'status-active' : 'status-inactive'}">${material.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'}</span></h3>
                                <p>${material.unit || '‡¶è‡¶ï‡¶ï ‡¶®‡ßá‡¶á'}</p>
                            </div>
                        </div>
                        <div class="material-stock">
                            <div class="stock-item">
                                <span>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï:</span>
                                <span class="${stockClass}">${material.stock} ${material.unit || ''}</span>
                            </div>
                            ${material.alertLevel > 0 ? `
                            <div class="stock-item">
                                <span>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶∏‡ßç‡¶§‡¶∞:</span>
                                <span>${material.alertLevel} ${material.unit || ''}</span>
                            </div>
                            ` : ''}
                        </div>
                        <div class="partner-stats">
                            <div class="partner-stat">
                                <label>‡¶Æ‡ßã‡¶ü ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</label>
                                <div class="value">‡ß≥ ${totalPurchase.toLocaleString('bn-BD')}</div>
                            </div>
                            <div class="partner-stat">
                                <label>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö</label>
                                <div class="value">${totalMaterial} ${material.unit || ''}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="showEditMaterialModal(${material.id})" ${currentUser.role === 'viewer' ? 'disabled' : ''}>‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMaterial(${material.id})" ${currentUser.role === 'viewer' ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteMaterial(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶è‡¶á ‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶∏‡¶ï‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá!')) {
                // ‡¶è‡¶á ‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶∏‡¶ï‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®
                materialTransactions = materialTransactions.filter(t => t.materialName !== materials.find(m => m.id === id).name);
                materials = materials.filter(m => m.id !== id);
                saveData();
                renderMaterials();
                renderMaterialTransactions();
                updateMaterialsDatalist();
                updateMaterialFilters();
            }
        }

        // Employee Management Functions
        function showAddEmployeeModal() {
            document.getElementById('employeeModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó';
            document.getElementById('employeeEditId').value = '';
            document.getElementById('employeeName').value = '';
            document.getElementById('employeePosition').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeSalary').value = '';
            document.getElementById('employeeJoinDate').value = '';
            document.getElementById('employeeStatus').value = 'active';
            document.getElementById('employeeModal').style.display = 'block';
        }

        function showEditEmployeeModal(id) {
            const employee = employees.find(e => e.id == id);
            if (employee) {
                document.getElementById('employeeModalTitle').textContent = '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
                document.getElementById('employeeEditId').value = employee.id;
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeePosition').value = employee.position;
                document.getElementById('employeePhone').value = employee.phone;
                document.getElementById('employeeSalary').value = employee.salary;
                document.getElementById('employeeJoinDate').value = employee.joinDate;
                document.getElementById('employeeStatus').value = employee.status;
                document.getElementById('employeeModal').style.display = 'block';
            }
        }

        function closeEmployeeModal() {
            document.getElementById('employeeModal').style.display = 'none';
        }

        function saveEmployee(e) {
            e.preventDefault();
            
            const id = document.getElementById('employeeEditId').value;
            const name = document.getElementById('employeeName').value;
            const position = document.getElementById('employeePosition').value;
            const phone = document.getElementById('employeePhone').value;
            const salary = parseFloat(document.getElementById('employeeSalary').value) || 0;
            const joinDate = document.getElementById('employeeJoinDate').value;
            const status = document.getElementById('employeeStatus').value;
            
            if (id) {
                // Edit existing employee
                const employee = employees.find(e => e.id == id);
                if (employee) {
                    employee.name = name;
                    employee.position = position;
                    employee.phone = phone;
                    employee.salary = salary;
                    employee.joinDate = joinDate;
                    employee.status = status;
                }
            } else {
                // Add new employee
                const newId = employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1;
                employees.push({
                    id: newId,
                    name,
                    position,
                    phone,
                    salary,
                    joinDate,
                    status
                });
            }
            
            saveData();
            renderEmployees();
            updateEmployeeSelect();
            closeEmployeeModal();
            
            alert('‚úÖ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        function renderEmployees() {
            const container = document.getElementById('employeesGrid');
            
            if (employees.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë®‚Äçüíº</div><h3>‡¶ï‡ßã‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = employees.map(employee => {
                return `
                    <div class="employee-card">
                        <div class="partner-header">
                            <div class="partner-avatar">${employee.name.charAt(0)}</div>
                            <div class="partner-info">
                                <h3>${employee.name} <span class="status-badge ${employee.status === 'active' ? 'status-active' : 'status-inactive'}">${employee.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'}</span></h3>
                                <p>${employee.position || '‡¶™‡¶¶‡¶¨‡¶ø ‡¶®‡ßá‡¶á'}</p>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üìû ‡¶´‡ßã‡¶®:</span>
                                <span>${employee.phone || '‡¶®‡ßá‡¶á'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üí∞ ‡¶¨‡ßá‡¶§‡¶®:</span>
                                <span style="font-weight: bold;">‡ß≥ ${employee.salary.toLocaleString('bn-BD')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>üìÖ ‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®:</span>
                                <span>${employee.joinDate ? formatDate(employee.joinDate) : '‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="showEditEmployeeModal(${employee.id})">‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.id})">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteEmployee(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                employees = employees.filter(e => e.id !== id);
                saveData();
                renderEmployees();
                updateEmployeeSelect();
            }
        }

        // Backup and Export Functions
        function exportToExcel() {
            const data = {
                transactions: transactions,
                materialTransactions: materialTransactions,
                partners: partners,
                employees: employees,
                materials: materials
            };
            
            const wb = XLSX.utils.book_new();
            
            // Transactions sheet
            const transactionsData = transactions.map(t => ({
                ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: formatDate(t.date),
                ‡¶Æ‡¶æ‡¶∏: t.month,
                ‡¶ß‡¶∞‡¶®: t.type,
                ‡¶ü‡¶æ‡¶ï‡¶æ: t.amount,
                ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ: t.employeeId ? employees.find(e => e.id == t.employeeId)?.name || '' : '',
                ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞: t.partner || '',
                ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description,
                '‡¶§‡ßà‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(t.createdAt).toLocaleString('bn-BD')
            }));
            const wsTransactions = XLSX.utils.json_to_sheet(transactionsData);
            XLSX.utils.book_append_sheet(wb, wsTransactions, '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®');
            
            // Material Transactions sheet
            const materialTransactionsData = materialTransactions.map(t => ({
                ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: formatDate(t.date),
                ‡¶Æ‡¶æ‡¶∏: t.month,
                ‡¶ß‡¶∞‡¶®: t.type,
                '‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ': t.materialName,
                ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: t.materialQuantity,
                ‡¶è‡¶ï‡¶ï: t.materialUnit || '',
                ‡¶¶‡¶æ‡¶Æ: t.amount,
                ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ: t.supplier || '',
                '‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞': t.memo || '',
                ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü: t.project || '',
                ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description,
                '‡¶§‡ßà‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(t.createdAt).toLocaleString('bn-BD')
            }));
            const wsMaterialTransactions = XLSX.utils.json_to_sheet(materialTransactionsData);
            XLSX.utils.book_append_sheet(wb, wsMaterialTransactions, '‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®');
            
            // Partners sheet
            const partnersData = partners.map(p => ({
                ‡¶®‡¶æ‡¶Æ: p.name,
                ‡¶´‡ßã‡¶®: p.phone,
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: p.status
            }));
            const wsPartners = XLSX.utils.json_to_sheet(partnersData);
            XLSX.utils.book_append_sheet(wb, wsPartners, '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞');
            
            // Employees sheet
            const employeesData = employees.map(e => ({
                ‡¶®‡¶æ‡¶Æ: e.name,
                ‡¶™‡¶¶‡¶¨‡¶ø: e.position,
                ‡¶´‡ßã‡¶®: e.phone,
                ‡¶¨‡ßá‡¶§‡¶®: e.salary,
                '‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': e.joinDate ? formatDate(e.joinDate) : '',
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: e.status
            }));
            const wsEmployees = XLSX.utils.json_to_sheet(employeesData);
            XLSX.utils.book_append_sheet(wb, wsEmployees, '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ');
            
            // Materials sheet
            const materialsData = materials.map(m => ({
                ‡¶®‡¶æ‡¶Æ: m.name,
                ‡¶è‡¶ï‡¶ï: m.unit,
                ‡¶∏‡ßç‡¶ü‡¶ï: m.stock,
                '‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶∏‡ßç‡¶§‡¶∞': m.alertLevel,
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: m.status
            }));
            const wsMaterials = XLSX.utils.json_to_sheet(materialsData);
            XLSX.utils.book_append_sheet(wb, wsMaterials, '‡¶Æ‡¶æ‡¶≤');
            
            XLSX.writeFile(wb, '‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ_‡¶π‡¶ø‡¶∏‡¶æ‡¶¨.xlsx');
        }

        function exportTransactionsToExcel() {
            const transactionsData = transactions.map(t => ({
                ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: formatDate(t.date),
                ‡¶Æ‡¶æ‡¶∏: t.month,
                ‡¶ß‡¶∞‡¶®: t.type,
                ‡¶ü‡¶æ‡¶ï‡¶æ: t.amount,
                ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ: t.employeeId ? employees.find(e => e.id == t.employeeId)?.name || '' : '',
                ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞: t.partner || '',
                ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description,
                '‡¶§‡ßà‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(t.createdAt).toLocaleString('bn-BD')
            }));
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(transactionsData);
            XLSX.utils.book_append_sheet(wb, ws, '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®');
            XLSX.writeFile(wb, '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®_‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.xlsx');
        }

        function exportPartnersToExcel() {
            const partnersData = partners.map(p => ({
                ‡¶®‡¶æ‡¶Æ: p.name,
                ‡¶´‡ßã‡¶®: p.phone,
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: p.status
            }));
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(partnersData);
            XLSX.utils.book_append_sheet(wb, ws, '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞');
            XLSX.writeFile(wb, '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞_‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.xlsx');
        }

        function exportEmployeesToExcel() {
            const employeesData = employees.map(e => ({
                ‡¶®‡¶æ‡¶Æ: e.name,
                ‡¶™‡¶¶‡¶¨‡¶ø: e.position,
                ‡¶´‡ßã‡¶®: e.phone,
                ‡¶¨‡ßá‡¶§‡¶®: e.salary,
                '‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': e.joinDate ? formatDate(e.joinDate) : '',
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: e.status
            }));
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(employeesData);
            XLSX.utils.book_append_sheet(wb, ws, '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ');
            XLSX.writeFile(wb, '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ_‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.xlsx');
        }

        function exportMaterialsToExcel() {
            const materialsData = materials.map(m => ({
                ‡¶®‡¶æ‡¶Æ: m.name,
                ‡¶è‡¶ï‡¶ï: m.unit,
                ‡¶∏‡ßç‡¶ü‡¶ï: m.stock,
                '‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶∏‡ßç‡¶§‡¶∞': m.alertLevel,
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: m.status
            }));
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(materialsData);
            XLSX.utils.book_append_sheet(wb, ws, '‡¶Æ‡¶æ‡¶≤');
            XLSX.writeFile(wb, '‡¶Æ‡¶æ‡¶≤_‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.xlsx');
        }

        function exportSalaryToExcel() {
            const salaryTransactions = transactions.filter(t => t.type === 'salary');
            
            const salaryData = salaryTransactions.map(t => {
                const employee = employees.find(e => e.id == t.employeeId);
                return {
                    ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: formatDate(t.date),
                    ‡¶Æ‡¶æ‡¶∏: t.month,
                    ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ: employee ? employee.name : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ',
                    ‡¶¨‡ßá‡¶§‡¶®: t.salaryAmount || 0,
                    ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: t.bonusAmount || 0,
                    ‡¶Ö‡¶ó‡ßç‡¶∞‡ßÄ‡¶Æ: t.advanceAmount || 0,
                    ‡¶Æ‡ßã‡¶ü: t.amount,
                    ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description,
                    '‡¶§‡ßà‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(t.createdAt).toLocaleString('bn-BD')
                };
            });
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(salaryData);
            XLSX.utils.book_append_sheet(wb, ws, '‡¶¨‡ßá‡¶§‡¶®');
            XLSX.writeFile(wb, '‡¶¨‡ßá‡¶§‡¶®_‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.xlsx');
        }

        function exportMaterialTransactionsToExcel() {
            const materialData = materialTransactions.map(t => {
                return {
                    ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: formatDate(t.date),
                    ‡¶Æ‡¶æ‡¶∏: t.month,
                    ‡¶ß‡¶∞‡¶®: t.type === 'purchase' ? '‡¶Æ‡¶æ‡¶≤ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º' : '‡¶Æ‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö',
                    '‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ': t.materialName,
                    ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: t.materialQuantity,
                    ‡¶è‡¶ï‡¶ï: t.materialUnit || '',
                    ‡¶¶‡¶æ‡¶Æ: t.type === 'purchase' ? t.amount : '-',
                    ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ: t.supplier || '',
                    '‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞': t.memo || '',
                    ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü: t.project || '',
                    ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description,
                    '‡¶§‡ßà‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(t.createdAt).toLocaleString('bn-BD')
                };
            });
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(materialData);
            XLSX.utils.book_append_sheet(wb, ws, '‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®');
            XLSX.writeFile(wb, '‡¶Æ‡¶æ‡¶≤_‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®_‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.xlsx');
        }

        function exportToJSON() {
            const data = {
                transactions: transactions,
                materialTransactions: materialTransactions,
                partners: partners,
                employees: employees,
                materials: materials,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = '‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ_‡¶π‡¶ø‡¶∏‡¶æ‡¶¨_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
        }

        function importFromJSON() {
            const fileInput = document.getElementById('jsonFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('‚ùå ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    transactions = data.transactions || [];
                    materialTransactions = data.materialTransactions || [];
                    partners = data.partners || [];
                    employees = data.employees || [];
                    materials = data.materials || [];
                    
                    saveData();
                    
                    // UI ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®
                    renderTransactions();
                    renderMaterialTransactions();
                    renderPartners();
                    renderEmployees();
                    renderMaterials();
                    renderSalaryTransactions();
                    updateDashboard();
                    updateMonthlySummary();
                    
                    alert('‚úÖ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                } catch (error) {
                    alert('‚ùå ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶∏‡¶†‡¶ø‡¶ï JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        }

        function importFromExcel() {
            const fileInput = document.getElementById('excelFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('‚ùå ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // Process each sheet
                    if (workbook.Sheets['‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®']) {
                        const transactionsData = XLSX.utils.sheet_to_json(workbook.Sheets['‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®']);
                        // Process transactions data
                    }
                    
                    if (workbook.Sheets['‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®']) {
                        const materialTransactionsData = XLSX.utils.sheet_to_json(workbook.Sheets['‡¶Æ‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®']);
                        // Process material transactions data
                    }
                    
                    // Add similar processing for other sheets
                    
                    alert('‚úÖ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                } catch (error) {
                    alert('‚ùå ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶∏‡¶†‡¶ø‡¶ï ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    console.error('Excel import error:', error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ!')) {
                localStorage.removeItem('businessData');
                transactions = [];
                materialTransactions = [];
                employees = [];
                materials = [];
                
                saveData();
                
                renderTransactions();
                renderMaterialTransactions();
                renderEmployees();
                renderMaterials();
                renderSalaryTransactions();
                updateDashboard();
                updateMonthlySummary();
                
                alert('‚úÖ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            }
        }

        // Initialize the application with Firebase Auth
        initializeAuth();

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target === modal) {
                closeImageModal();
            }
            
            const partnerModal = document.getElementById('partnerModal');
            if (event.target === partnerModal) {
                closePartnerModal();
            }
            
            const materialModal = document.getElementById('materialModal');
            if (event.target === materialModal) {
                closeMaterialModal();
            }
            
            const employeeModal = document.getElementById('employeeModal');
            if (event.target === employeeModal) {
                closeEmployeeModal();
            }
        };
    </script>
</body>
</html>