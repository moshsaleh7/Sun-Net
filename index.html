<script>
    // Firebase Configuration - ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
    const firebaseConfig = {
        apiKey: "AIzaSyA9fFXPWffefF17n8KgcA6gFBGqo0kQwd8",
        authDomain: "sunnet-91692.firebaseapp.com",
        databaseURL: "https://sunnet-91692-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sunnet-91692",
        storageBucket: "sunnet-91692.firebasestorage.app",
        messagingSenderId: "494362733387",
        appId: "1:494362733387:web:f21fecafa6d39e07d756ce",
        measurementId: "G-30R6BPZTWQ"
    };

    // Firebase Initialize
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Global Variables
    let transactions = [];
    let partners = [
        { id: 1, name: '‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶π‡ßã‡¶∏‡ßá‡¶®', phone: '‡ß¶‡ßß‡ß≠‡ßß‡ßß-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', status: 'active' },
        { id: 2, name: '‡¶∞‡¶π‡¶ø‡¶Æ ‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ß®‡ß®-‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', status: 'active' },
        { id: 3, name: '‡¶ï‡¶∞‡¶ø‡¶Æ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ', phone: '‡ß¶‡ßß‡ßØ‡ß©‡ß©-‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ', status: 'active' },
        { id: 4, name: '‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ß≠‡ß™‡ß™-‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ', status: 'active' },
        { id: 5, name: '‡¶ú‡¶æ‡¶π‡¶ø‡¶¶ ‡¶Ü‡¶≤‡ßÄ', phone: '‡ß¶‡ßß‡ßÆ‡ß´‡ß´-‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶', status: 'active' },
        { id: 6, name: '‡¶®‡¶æ‡¶∏‡¶ø‡¶∞ ‡¶â‡¶≤‡ßç‡¶≤‡¶æ‡¶π', phone: '‡ß¶‡ßß‡ßØ‡ß¨‡ß¨-‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶‡ßß', status: 'active' },
        { id: 7, name: '‡¶´‡¶æ‡¶∞‡ßÅ‡¶ï ‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶', phone: '‡ß¶‡ßß‡ß≠‡ß≠‡ß≠-‡ß≠‡ßÆ‡ßØ‡ß¶‡ßß‡ß®', status: 'active' },
        { id: 8, name: '‡¶∂‡¶´‡¶ø‡¶ï ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ßÆ‡ßÆ-‡ßÆ‡ßØ‡ß¶‡ßß‡ß®‡ß©', status: 'active' },
        { id: 9, name: '‡¶Æ‡¶æ‡¶π‡¶Æ‡ßÅ‡¶¶ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßØ‡ßØ‡ßØ-‡ßØ‡ß¶‡ßß‡ß®‡ß©‡ß™', status: 'active' },
        { id: 10, name: '‡¶Ü‡¶®‡ßã‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶π‡ßá‡¶¨', phone: '‡ß¶‡ßß‡ß≠‡ß¶‡ß¶-‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´', status: 'active' },
        { id: 11, name: '‡¶¨‡¶æ‡¶¨‡ßÅ‡¶≤ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ', phone: '‡ß¶‡ßß‡ßÆ‡ßß‡ßß-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', status: 'active' },
        { id: 12, name: '‡¶ï‡¶æ‡¶Æ‡¶æ‡¶≤ ‡¶™‡¶æ‡¶∂‡¶æ', phone: '‡ß¶‡ßß‡ßØ‡ß®‡ß®-‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', status: 'active' }
    ];
    let employees = [];
    let currentUser = null;
    let dailyChart = null;
    let monthlyChart = null;
    let isOnline = true;
    let appUsers = {};

    const monthNames = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];

    // üî• Firebase Functions - Users Management
    function syncUsersToFirebase() {
        if (!currentUser || currentUser.role !== 'admin') return;
        
        db.collection('appUsers').doc('usersData').set(appUsers)
            .then(() => {
                console.log('‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ Firebase ‡¶è ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            })
            .catch((error) => {
                console.error('‚ùå Firebase Users Error:', error);
            });
    }

    function listenForUsersChanges() {
        db.collection('appUsers').doc('usersData')
            .onSnapshot((doc) => {
                if (doc.exists) {
                    const firebaseUsers = doc.data();
                    appUsers = firebaseUsers;
                    
                    // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá‡¶ì ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                    localStorage.setItem('appUsers', JSON.stringify(appUsers));
                    
                    console.log('‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                }
            }, (error) => {
                console.error('‚ùå Firebase Users Listen Error:', error);
            });
    }

    // üî• Firebase Functions - Business Data
    function syncDataToFirebase() {
        if (!currentUser || currentUser.role !== 'admin') return;
        
        const businessData = {
            transactions: transactions,
            partners: partners,
            employees: employees,
            lastUpdated: new Date().toISOString(),
            updatedBy: currentUser.name
        };
        
        db.collection('businessData').doc('mainData').set(businessData)
            .then(() => {
                console.log('‚úÖ ‡¶°‡¶æ‡¶ü‡¶æ Firebase ‡¶è ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                showNotification('‚úÖ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            })
            .catch((error) => {
                console.error('‚ùå Firebase Error:', error);
                showNotification('‚ùå ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!');
                isOnline = false;
                updateConnectionStatus();
            });
    }

    function listenForDataChanges() {
        db.collection('businessData').doc('mainData')
            .onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    const previousTransactionsCount = transactions.length;
                    
                    transactions = data.transactions || [];
                    partners = data.partners || [];
                    employees = data.employees || [];
                    
                    // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                    renderTransactions();
                    renderPartners();
                    renderEmployees();
                    updateDashboard();
                    updatePartnersDatalist();
                    updateFilters();
                    
                    // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶≤‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                    if (previousTransactionsCount !== transactions.length && currentUser.role === 'viewer') {
                        showNotification('üîÑ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    }
                    
                    isOnline = true;
                    updateConnectionStatus();
                }
            }, (error) => {
                console.error('‚ùå Firebase Listen Error:', error);
                isOnline = false;
                updateConnectionStatus();
            });
    }

    function showNotification(message) {
        // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®
        const existingNotification = document.querySelector('.live-notification');
        if (existingNotification) {
            existingNotification.remove();
        }
        
        const notification = document.createElement('div');
        notification.className = 'live-notification';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-weight: bold;
            animation: slideIn 0.3s ease-out;
        `;
        
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 3000);
    }

    function updateConnectionStatus() {
        let statusDiv = document.getElementById('connectionStatus');
        if (!statusDiv) {
            statusDiv = document.createElement('div');
            statusDiv.id = 'connectionStatus';
            statusDiv.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                padding: 8px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: bold;
                z-index: 1000;
                color: white;
            `;
            document.body.appendChild(statusDiv);
        }
        
        if (isOnline) {
            statusDiv.textContent = 'üü¢ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®';
            statusDiv.style.background = '#28a745';
        } else {
            statusDiv.textContent = 'üî¥ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®';
            statusDiv.style.background = '#dc3545';
        }
    }

    // üéØ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° saveData ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function saveData() {
        const data = {
            transactions,
            partners,
            employees,
            lastUpdated: new Date().toISOString()
        };
        
        // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡ßá‡¶≠
        localStorage.setItem('businessData', JSON.stringify(data));
        
        // Firebase ‡¶è ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï (‡¶Ø‡¶¶‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡ßü)
        syncDataToFirebase();
    }

    // üéØ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° loadData ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function loadData() {
        // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        const saved = localStorage.getItem('businessData');
        if (saved) {
            const data = JSON.parse(saved);
            transactions = data.transactions || [];
            partners = data.partners || [];
            employees = data.employees || [];
        }
        
        // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®
        listenForDataChanges();
    }

    // üéØ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function getUsers() {
        // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        if (Object.keys(appUsers).length > 0) {
            return appUsers;
        }
        
        // ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        const saved = localStorage.getItem('appUsers');
        if (saved) {
            appUsers = JSON.parse(saved);
            return appUsers;
        }
        
        // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
        appUsers = {
            admin: { password: 'admin123', role: 'admin', name: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' },
            viewer: { password: 'viewer123', role: 'viewer', name: '‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞' }
        };
        
        // Firebase ‡¶è ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        syncUsersToFirebase();
        
        return appUsers;
    }

    function saveUsers(users) {
        appUsers = users;
        localStorage.setItem('appUsers', JSON.stringify(appUsers));
        
        // Firebase ‡¶è ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        syncUsersToFirebase();
    }

    function init() {
        // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        listenForUsersChanges();
        
        // ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        const saved = localStorage.getItem('currentUser');
        if (saved) {
            currentUser = JSON.parse(saved);
            showMainApp();
        } else {
            document.getElementById('loginScreen').style.display = 'block';
        }
        
        // ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        loadData();
    }

    function handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        const users = getUsers();

        if (users[username] && users[username].password === password) {
            currentUser = { username, role: users[username].role, name: users[username].name };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
        } else {
            alert('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!');
        }
    }

    function logout() {
        if (confirm('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        }
    }

    function showMainApp() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('currentUserName').textContent = currentUser.name;
        document.getElementById('currentUserRole').textContent = currentUser.role === 'admin' ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : '‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞';
        
        applyPermissions();
        populateMonthDropdowns();
        updatePartnersDatalist();
        updateFilters();
        setDefaultDate();
        renderTransactions();
        renderPartners();
        renderEmployees();
        updateDashboard();
    }

    function applyPermissions() {
        const isAdmin = currentUser.role === 'admin';
        const isViewer = currentUser.role === 'viewer';
        
        // Show/hide elements based on role
        document.getElementById('txFormCard').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('addPartnerBtn').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('employeesTab').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('backupTab').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('settingsTab').style.display = isAdmin ? 'block' : 'none';
        
        // Disable forms for viewer
        if (isViewer) {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.querySelectorAll('input, select, textarea').forEach(field => {
                    field.disabled = true;
                });
            });
        }
    }

    function setDefaultDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const todayStr = `${year}-${month}-${day}`;
        document.getElementById('txDate').value = todayStr;
        document.getElementById('txDate').max = todayStr;
    }

    function populateMonthDropdowns() {
        const months = getAvailableMonths();
        const monthSelects = ['txMonth', 'filterMonth', 'dashboardMonthSelect'];
        
        monthSelects.forEach(selectId => {
            const select = document.getElementById(selectId);
            select.innerHTML = selectId === 'filterMonth' || selectId === 'dashboardMonthSelect' ? 
                '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>' : '<option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.textContent = month.label;
                select.appendChild(option);
            });
        });
    }

    function getAvailableMonths() {
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth();
        const months = [];
        
        for (let year = currentYear - 3; year <= currentYear; year++) {
            const endMonth = (year === currentYear) ? currentMonth : 11;
            for (let month = 0; month <= endMonth; month++) {
                const yearBn = year.toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
                months.push({
                    value: `${monthNames[month]} ${yearBn}`,
                    label: `${monthNames[month]} ${yearBn}`
                });
            }
        }
        
        return months;
    }

    function updateMonthFromDate() {
        const dateInput = document.getElementById('txDate');
        const monthSelect = document.getElementById('txMonth');
        if (dateInput.value) {
            const date = new Date(dateInput.value);
            const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            const monthName = monthNames[date.getMonth()];
            const monthValue = `${monthName} ${year}`;
            monthSelect.value = monthValue;
        }
    }

    function updatePartnersDatalist() {
        const datalist = document.getElementById('partnersList');
        datalist.innerHTML = '';
        partners.forEach(partner => {
            const option = document.createElement('option');
            option.value = partner.name;
            datalist.appendChild(option);
        });
    }

    function updateFilters() {
        const partnerFilter = document.getElementById('filterPartner');
        partnerFilter.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</option>';
        
        partners.forEach(partner => {
            const option = document.createElement('option');
            option.value = partner.name;
            option.textContent = partner.name;
            partnerFilter.appendChild(option);
        });
    }

    function addTransaction(e) {
        e.preventDefault();
        
        const transaction = {
            id: Date.now(),
            date: document.getElementById('txDate').value,
            month: document.getElementById('txMonth').value,
            type: document.getElementById('txType').value,
            amount: parseFloat(document.getElementById('txAmount').value),
            partner: document.getElementById('txPartner').value,
            description: document.getElementById('txDescription').value
        };
        
        transactions.push(transaction);
        saveData();
        e.target.reset();
        setDefaultDate();
        
        alert('‚úÖ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
    }

    function deleteTransaction(id) {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
            transactions = transactions.filter(t => t.id !== id);
            saveData();
        }
    }

    function renderTransactions() {
        const tbody = document.getElementById('transactionsBody');
        const filterMonth = document.getElementById('filterMonth').value;
        const filterType = document.getElementById('filterType').value;
        const filterPartner = document.getElementById('filterPartner').value;
        
        let filtered = transactions;
        
        if (filterMonth !== 'all') {
            filtered = filtered.filter(t => t.month === filterMonth);
        }
        
        if (filterType !== 'all') {
            filtered = filtered.filter(t => t.type === filterType);
        }
        
        if (filterPartner !== 'all') {
            filtered = filtered.filter(t => t.partner === filterPartner);
        }
        
        if (filtered.length === 0) {
            tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">‡¶ï‡ßã‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>`;
            return;
        }
        
        tbody.innerHTML = filtered.map(transaction => `
            <tr>
                <td>${formatDate(transaction.date)}</td>
                <td>${transaction.month}</td>
                <td><span class="badge ${transaction.type === 'income' ? 'badge-income' : 'badge-expense'}">${transaction.type === 'income' ? '‡¶ú‡¶Æ‡¶æ' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º'}</span></td>
                <td style="font-weight: bold; color: ${transaction.type === 'income' ? '#28a745' : '#dc3545'}">‡ß≥ ${transaction.amount.toLocaleString('bn-BD')}</td>
                <td>${transaction.partner || '-'}</td>
                <td>${transaction.description}</td>
                <td>
                    ${currentUser.role === 'admin' ? `
                        <button class="btn btn-danger btn-sm" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                    ` : ''}
                </td>
            </tr>
        `).join('');
    }

    function formatDate(dateStr) {
        const date = new Date(dateStr);
        const day = date.getDate().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
        const month = (date.getMonth() + 1).toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
        const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
        return `${day}/${month}/${year}`;
    }

    function updateDashboard() {
        const selectedMonth = document.getElementById('dashboardMonthSelect').value;
        let filtered = transactions;
        
        if (selectedMonth !== 'all') {
            filtered = transactions.filter(t => t.month === selectedMonth);
        }
        
        const totalIncome = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const totalExpense = filtered.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        const netProfit = totalIncome - totalExpense;
        
        document.getElementById('totalIncome').textContent = totalIncome.toLocaleString('bn-BD');
        document.getElementById('totalExpense').textContent = totalExpense.toLocaleString('bn-BD');
        document.getElementById('netProfit').textContent = netProfit.toLocaleString('bn-BD');
        document.getElementById('totalTransactions').textContent = filtered.length.toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
        
        updateCharts(filtered);
    }

    function updateCharts(filteredTransactions) {
        // Daily Chart
        const dailyData = {};
        filteredTransactions.forEach(t => {
            if (!dailyData[t.date]) {
                dailyData[t.date] = { income: 0, expense: 0 };
            }
            if (t.type === 'income') {
                dailyData[t.date].income += t.amount;
            } else {
                dailyData[t.date].expense += t.amount;
            }
        });
        
        const dates = Object.keys(dailyData).sort();
        const incomeData = dates.map(date => dailyData[date].income);
        const expenseData = dates.map(date => dailyData[date].expense);
        
        const dailyCtx = document.getElementById('dailyChart').getContext('2d');
        if (dailyChart) dailyChart.destroy();
        
        dailyChart = new Chart(dailyCtx, {
            type: 'line',
            data: {
                labels: dates.map(d => formatDate(d)),
                datasets: [
                    {
                        label: '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º',
                        data: incomeData,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö',
                        data: expenseData,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®' }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '‡ß≥ ' + value.toLocaleString('bn-BD');
                            }
                        }
                    }
                }
            }
        });
        
        // Monthly Chart
        const monthlyData = {};
        transactions.forEach(t => {
            if (!monthlyData[t.month]) {
                monthlyData[t.month] = { income: 0, expense: 0 };
            }
            if (t.type === 'income') {
                monthlyData[t.month].income += t.amount;
            } else {
                monthlyData[t.month].expense += t.amount;
            }
        });
        
        const months = Object.keys(monthlyData).sort();
        const monthlyIncome = months.map(month => monthlyData[month].income);
        const monthlyExpense = months.map(month => monthlyData[month].expense);
        
        const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
        if (monthlyChart) monthlyChart.destroy();
        
        monthlyChart = new Chart(monthlyCtx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º',
                        data: monthlyIncome,
                        backgroundColor: '#28a745',
                        borderColor: '#28a745',
                        borderWidth: 1
                    },
                    {
                        label: '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö',
                        data: monthlyExpense,
                        backgroundColor: '#dc3545',
                        borderColor: '#dc3545',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: '‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ' }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '‡ß≥ ' + value.toLocaleString('bn-BD');
                            }
                        }
                    }
                }
            }
        });
    }

    function exportMonthlyData() {
        const monthlyData = {};
        transactions.forEach(t => {
            if (!monthlyData[t.month]) {
                monthlyData[t.month] = { income: 0, expense: 0, transactions: [] };
            }
            monthlyData[t.month].income += t.type === 'income' ? t.amount : 0;
            monthlyData[t.month].expense += t.type === 'expense' ? t.amount : 0;
            monthlyData[t.month].transactions.push(t);
        });
        
        let html = '<div style="font-family: Arial, sans-serif;">';
        html += '<h2 style="text-align: center; color: #667eea;">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>';
        
        Object.keys(monthlyData).sort().forEach(month => {
            const data = monthlyData[month];
            const profit = data.income - data.expense;
            
            html += `<div style="margin-bottom: 30px; border: 2px solid #667eea; border-radius: 10px; padding: 20px;">`;
            html += `<h3 style="color: #667eea; border-bottom: 2px solid #dee2e6; padding-bottom: 10px;">${month}</h3>`;
            html += `<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">`;
            html += `<div style="background: #d4edda; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º:</strong><br>‡ß≥ ${data.income.toLocaleString('bn-BD')}</div>`;
            html += `<div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º:</strong><br>‡ß≥ ${data.expense.toLocaleString('bn-BD')}</div>`;
            html += `<div style="background: ${profit >= 0 ? '#d4edda' : '#f8d7da'}; padding: 15px; border-radius: 8px; text-align: center;"><strong>‡¶≤‡¶æ‡¶≠/‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®:</strong><br>‡ß≥ ${Math.abs(profit).toLocaleString('bn-BD')} (${profit >= 0 ? '‡¶≤‡¶æ‡¶≠' : '‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®'})</div>`;
            html += `</div>`;
            
            html += `<h4 style="margin-bottom: 10px;">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶Æ‡ßÇ‡¶π:</h4>`;
            html += `<table style="width: 100%; border-collapse: collapse;">`;
            html += `<tr style="background: #667eea; color: white;"><th style="padding: 10px; text-align: left;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th style="padding: 10px; text-align: left;">‡¶ß‡¶∞‡¶®</th><th style="padding: 10px; text-align: left;">‡¶ü‡¶æ‡¶ï‡¶æ</th><th style="padding: 10px; text-align: left;">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th></tr>`;
            
            data.transactions.forEach(t => {
                html += `<tr style="border-bottom: 1px solid #dee2e6;">`;
                html += `<td style="padding: 8px 10px;">${formatDate(t.date)}</td>`;
                html += `<td style="padding: 8px 10px;"><span style="padding: 4px 8px; border-radius: 4px; background: ${t.type === 'income' ? '#d4edda' : '#f8d7da'}; color: ${t.type === 'income' ? '#155724' : '#721c24'};">${t.type === 'income' ? '‡¶ú‡¶Æ‡¶æ' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º'}</span></td>`;
                html += `<td style="padding: 8px 10px; font-weight: bold; color: ${t.type === 'income' ? '#28a745' : '#dc3545'};">‡ß≥ ${t.amount.toLocaleString('bn-BD')}</td>`;
                html += `<td style="padding: 8px 10px;">${t.description}</td>`;
                html += `</tr>`;
            });
            
            html += `</table>`;
            html += `</div>`;
        });
        
        html += '</div>';
        
        const win = window.open('', '_blank');
        win.document.write(html);
        win.document.close();
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');
        
        if (tabName === 'dashboard') {
            updateDashboard();
        }
    }

    function showAddPartnerModal() {
        document.getElementById('partnerModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó';
        document.getElementById('partnerEditId').value = '';
        document.getElementById('partnerName').value = '';
        document.getElementById('partnerPhone').value = '';
        document.getElementById('partnerStatus').value = 'active';
        document.getElementById('partnerModal').style.display = 'block';
    }

    function showEditPartnerModal(id) {
        const partner = partners.find(p => p.id == id);
        if (partner) {
            document.getElementById('partnerModalTitle').textContent = '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
            document.getElementById('partnerEditId').value = partner.id;
            document.getElementById('partnerName').value = partner.name;
            document.getElementById('partnerPhone').value = partner.phone;
            document.getElementById('partnerStatus').value = partner.status;
            document.getElementById('partnerModal').style.display = 'block';
        }
    }

    function closePartnerModal() {
        document.getElementById('partnerModal').style.display = 'none';
    }

    function savePartner(e) {
        e.preventDefault();
        
        const id = document.getElementById('partnerEditId').value;
        const name = document.getElementById('partnerName').value;
        const phone = document.getElementById('partnerPhone').value;
        const status = document.getElementById('partnerStatus').value;
        
        if (id) {
            // Edit existing partner
            const partner = partners.find(p => p.id == id);
            if (partner) {
                partner.name = name;
                partner.phone = phone;
                partner.status = status;
            }
        } else {
            // Add new partner
            const newId = partners.length > 0 ? Math.max(...partners.map(p => p.id)) + 1 : 1;
            partners.push({
                id: newId,
                name,
                phone,
                status
            });
        }
        
        saveData();
        renderPartners();
        updatePartnersDatalist();
        updateFilters();
        closePartnerModal();
        
        alert('‚úÖ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
    }

    function renderPartners() {
        const container = document.getElementById('partnersReport');
        
        if (partners.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><h3>‡¶ï‡ßã‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
            return;
        }
        
        container.innerHTML = partners.map(partner => {
            const partnerTransactions = transactions.filter(t => t.partner === partner.name);
            const totalIncome = partnerTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = partnerTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const netAmount = totalIncome - totalExpense;
            
            return `
                <div class="partner-card">
                    <div class="partner-header">
                        <div class="partner-avatar">${partner.name.charAt(0)}</div>
                        <div class="partner-info">
                            <h3>${partner.name} <span class="status-badge ${partner.status === 'active' ? 'status-active' : 'status-inactive'}">${partner.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'}</span></h3>
                            <p>üìû ${partner.phone || '‡¶®‡ßá‡¶á'}</p>
                        </div>
                    </div>
                    <div class="partner-stats">
                        <div class="partner-stat income">
                            <label>‡¶ú‡¶Æ‡¶æ</label>
                            <div class="value">‡ß≥ ${totalIncome.toLocaleString('bn-BD')}</div>
                        </div>
                        <div class="partner-stat expense">
                            <label>‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</label>
                            <div class="value">‡ß≥ ${totalExpense.toLocaleString('bn-BD')}</div>
                        </div>
                        <div class="partner-stat" style="grid-column: 1 / -1;">
                            <label>‡¶®‡¶ø‡¶ü</label>
                            <div class="value" style="color: ${netAmount >= 0 ? '#28a745' : '#dc3545'}">‡ß≥ ${Math.abs(netAmount).toLocaleString('bn-BD')}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-sm" onclick="showEditPartnerModal(${partner.id})" ${currentUser.role === 'viewer' ? 'disabled' : ''}>‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                        <button class="btn btn-danger btn-sm" onclick="deletePartner(${partner.id})" ${currentUser.role === 'viewer' ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function deletePartner(id) {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
            partners = partners.filter(p => p.id !== id);
            saveData();
            renderPartners();
            updatePartnersDatalist();
            updateFilters();
        }
    }

    function showAddEmployeeModal() {
        document.getElementById('employeeModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó';
        document.getElementById('employeeEditId').value = '';
        document.getElementById('employeeName').value = '';
        document.getElementById('employeePosition').value = '';
        document.getElementById('employeePhone').value = '';
        document.getElementById('employeeSalary').value = '';
        document.getElementById('employeeJoinDate').value = '';
        document.getElementById('employeeStatus').value = 'active';
        document.getElementById('employeeModal').style.display = 'block';
    }

    function showEditEmployeeModal(id) {
        const employee = employees.find(e => e.id == id);
        if (employee) {
            document.getElementById('employeeModalTitle').textContent = '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
            document.getElementById('employeeEditId').value = employee.id;
            document.getElementById('employeeName').value = employee.name;
            document.getElementById('employeePosition').value = employee.position;
            document.getElementById('employeePhone').value = employee.phone;
            document.getElementById('employeeSalary').value = employee.salary;
            document.getElementById('employeeJoinDate').value = employee.joinDate;
            document.getElementById('employeeStatus').value = employee.status;
            document.getElementById('employeeModal').style.display = 'block';
        }
    }

    function closeEmployeeModal() {
        document.getElementById('employeeModal').style.display = 'none';
    }

    function saveEmployee(e) {
        e.preventDefault();
        
        const id = document.getElementById('employeeEditId').value;
        const name = document.getElementById('employeeName').value;
        const position = document.getElementById('employeePosition').value;
        const phone = document.getElementById('employeePhone').value;
        const salary = parseFloat(document.getElementById('employeeSalary').value) || 0;
        const joinDate = document.getElementById('employeeJoinDate').value;
        const status = document.getElementById('employeeStatus').value;
        
        if (id) {
            // Edit existing employee
            const employee = employees.find(e => e.id == id);
            if (employee) {
                employee.name = name;
                employee.position = position;
                employee.phone = phone;
                employee.salary = salary;
                employee.joinDate = joinDate;
                employee.status = status;
            }
        } else {
            // Add new employee
            const newId = employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1;
            employees.push({
                id: newId,
                name,
                position,
                phone,
                salary,
                joinDate,
                status
            });
        }
        
        saveData();
        renderEmployees();
        closeEmployeeModal();
        
        alert('‚úÖ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
    }

    function renderEmployees() {
        const container = document.getElementById('employeesGrid');
        
        if (employees.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë®‚Äçüíº</div><h3>‡¶ï‡ßã‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
            return;
        }
        
        container.innerHTML = employees.map(employee => {
            return `
                <div class="employee-card">
                    <div class="partner-header">
                        <div class="partner-avatar">${employee.name.charAt(0)}</div>
                        <div class="partner-info">
                            <h3>${employee.name} <span class="status-badge ${employee.status === 'active' ? 'status-active' : 'status-inactive'}">${employee.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'}</span></h3>
                            <p>${employee.position || '‡¶™‡¶¶‡¶¨‡¶ø ‡¶®‡ßá‡¶á'}</p>
                        </div>
                    </div>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>üìû ‡¶´‡ßã‡¶®:</span>
                            <span>${employee.phone || '‡¶®‡ßá‡¶á'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>üí∞ ‡¶¨‡ßá‡¶§‡¶®:</span>
                            <span style="font-weight: bold;">‡ß≥ ${employee.salary.toLocaleString('bn-BD')}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>üìÖ ‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®:</span>
                            <span>${employee.joinDate ? formatDate(employee.joinDate) : '‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}</span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-sm" onclick="showEditEmployeeModal(${employee.id})">‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.id})">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function deleteEmployee(id) {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
            employees = employees.filter(e => e.id !== id);
            saveData();
            renderEmployees();
        }
    }

    // üéØ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function changeAdminPassword(e) {
        e.preventDefault();
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        const users = getUsers();
        
        if (users.admin.password !== currentPassword) {
            showAlert('settingsAlert', '‚ùå ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!', 'danger');
            return;
        }
        
        if (newPassword !== confirmPassword) {
            showAlert('settingsAlert', '‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!', 'danger');
            return;
        }
        
        users.admin.password = newPassword;
        saveUsers(users);
        showAlert('settingsAlert', '‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
        e.target.reset();
    }

    function changeViewerPassword(e) {
        e.preventDefault();
        const currentPassword = document.getElementById('currentViewerPassword').value;
        const newPassword = document.getElementById('newViewerPassword').value;
        const confirmPassword = document.getElementById('confirmViewerPassword').value;
        
        const users = getUsers();
        
        if (users.viewer.password !== currentPassword) {
            showAlert('viewerAlert', '‚ùå ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!', 'danger');
            return;
        }
        
        if (newPassword !== confirmPassword) {
            showAlert('viewerAlert', '‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!', 'danger');
            return;
        }
        
        users.viewer.password = newPassword;
        saveUsers(users);
        showAlert('viewerAlert', '‚úÖ ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
        e.target.reset();
    }

    function showAlert(containerId, message, type) {
        const container = document.getElementById(containerId);
        container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        setTimeout(() => {
            container.innerHTML = '';
        }, 5000);
    }

    function clearAllData() {
        if (confirm('‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá!')) {
            localStorage.removeItem('businessData');
            transactions = [];
            partners = [];
            employees = [];
            renderTransactions();
            renderPartners();
            renderEmployees();
            updateDashboard();
            alert('‚úÖ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
        }
    }

    // Backup and Export Functions
    function exportToExcel() {
        const data = {
            transactions,
            partners,
            employees
        };
        
        const wb = XLSX.utils.book_new();
        
        // Transactions sheet
        const transactionsData = transactions.map(t => ({
            ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: t.date,
            ‡¶Æ‡¶æ‡¶∏: t.month,
            ‡¶ß‡¶∞‡¶®: t.type === 'income' ? '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö',
            ‡¶ü‡¶æ‡¶ï‡¶æ: t.amount,
            ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞: t.partner || '',
            ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description
        }));
        const wsTransactions = XLSX.utils.json_to_sheet(transactionsData);
        XLSX.utils.book_append_sheet(wb, wsTransactions, '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®');
        
        // Partners sheet
        const partnersData = partners.map(p => ({
            ‡¶®‡¶æ‡¶Æ: p.name,
            ‡¶´‡ßã‡¶®: p.phone || '',
            ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: p.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'
        }));
        const wsPartners = XLSX.utils.json_to_sheet(partnersData);
        XLSX.utils.book_append_sheet(wb, wsPartners, '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞');
        
        // Employees sheet
        const employeesData = employees.map(e => ({
            ‡¶®‡¶æ‡¶Æ: e.name,
            ‡¶™‡¶¶‡¶¨‡¶ø: e.position || '',
            ‡¶´‡ßã‡¶®: e.phone || '',
            ‡¶¨‡ßá‡¶§‡¶®: e.salary,
            ‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®: e.joinDate || '',
            ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: e.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'
        }));
        const wsEmployees = XLSX.utils.json_to_sheet(employeesData);
        XLSX.utils.book_append_sheet(wb, wsEmployees, '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ');
        
        XLSX.writeFile(wb, 'business_data_backup.xlsx');
        showAlert('backupAlert', '‚úÖ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
    }

    function exportToJSON() {
        const data = {
            transactions,
            partners,
            employees,
            exportDate: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'business_data_backup.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showAlert('backupAlert', '‚úÖ JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
    }

    function importFromJSON() {
        const fileInput = document.getElementById('jsonFileInput');
        fileInput.click();
        fileInput.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶è‡¶ü‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡¶¨‡ßá!')) {
                        transactions = data.transactions || [];
                        partners = data.partners || [];
                        employees = data.employees || [];
                        
                        saveData();
                        renderTransactions();
                        renderPartners();
                        renderEmployees();
                        updateDashboard();
                        updatePartnersDatalist();
                        updateFilters();
                        
                        showAlert('backupAlert', '‚úÖ JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
                    }
                } catch (error) {
                    showAlert('backupAlert', '‚ùå JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'danger');
                }
            };
            reader.readAsText(file);
            fileInput.value = '';
        };
    }

    function importFromExcel() {
        const fileInput = document.getElementById('excelFileInput');
        fileInput.click();
        fileInput.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶è‡¶ü‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡¶¨‡ßá!')) {
                        // Read transactions
                        if (workbook.Sheets['‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®']) {
                            const transactionsData = XLSX.utils.sheet_to_json(workbook.Sheets['‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®']);
                            transactions = transactionsData.map(t => ({
                                id: Date.now() + Math.random(),
                                date: t.‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ,
                                month: t.‡¶Æ‡¶æ‡¶∏,
                                type: t.‡¶ß‡¶∞‡¶® === '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º' ? 'income' : 'expense',
                                amount: t.‡¶ü‡¶æ‡¶ï‡¶æ,
                                partner: t.‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞,
                                description: t.‡¶¨‡¶ø‡¶¨‡¶∞‡¶£
                            }));
                        }
                        
                        // Read partners
                        if (workbook.Sheets['‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞']) {
                            const partnersData = XLSX.utils.sheet_to_json(workbook.Sheets['‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞']);
                            partners = partnersData.map((p, index) => ({
                                id: index + 1,
                                name: p.‡¶®‡¶æ‡¶Æ,
                                phone: p.‡¶´‡ßã‡¶®,
                                status: p.‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ === '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' ? 'active' : 'inactive'
                            }));
                        }
                        
                        // Read employees
                        if (workbook.Sheets['‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ']) {
                            const employeesData = XLSX.utils.sheet_to_json(workbook.Sheets['‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ']);
                            employees = employeesData.map((e, index) => ({
                                id: index + 1,
                                name: e.‡¶®‡¶æ‡¶Æ,
                                position: e.‡¶™‡¶¶‡¶¨‡¶ø,
                                phone: e.‡¶´‡ßã‡¶®,
                                salary: e.‡¶¨‡ßá‡¶§‡¶®,
                                joinDate: e.‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®,
                                status: e.‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ === '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' ? 'active' : 'inactive'
                            }));
                        }
                        
                        saveData();
                        renderTransactions();
                        renderPartners();
                        renderEmployees();
                        updateDashboard();
                        updatePartnersDatalist();
                        updateFilters();
                        
                        showAlert('backupAlert', '‚úÖ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
                    }
                } catch (error) {
                    showAlert('backupAlert', '‚ùå ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'danger');
                }
            };
            reader.readAsArrayBuffer(file);
            fileInput.value = '';
        };
    }

    function exportTransactionsToExcel() {
        const transactionsData = transactions.map(t => ({
            ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: t.date,
            ‡¶Æ‡¶æ‡¶∏: t.month,
            ‡¶ß‡¶∞‡¶®: t.type === 'income' ? '‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö',
            ‡¶ü‡¶æ‡¶ï‡¶æ: t.amount,
            ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞: t.partner || '',
            ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: t.description
        }));
        
        const ws = XLSX.utils.json_to_sheet(transactionsData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®');
        XLSX.writeFile(wb, 'transactions_report.xlsx');
        showAlert('backupAlert', '‚úÖ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
    }

    function exportPartnersToExcel() {
        const partnersData = partners.map(p => {
            const partnerTransactions = transactions.filter(t => t.partner === p.name);
            const totalIncome = partnerTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = partnerTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const netAmount = totalIncome - totalExpense;
            
            return {
                ‡¶®‡¶æ‡¶Æ: p.name,
                ‡¶´‡ßã‡¶®: p.phone || '',
                ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: p.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß',
                ‡¶Æ‡ßã‡¶ü_‡¶ú‡¶Æ‡¶æ: totalIncome,
                ‡¶Æ‡ßã‡¶ü_‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: totalExpense,
                ‡¶®‡¶ø‡¶ü_‡¶≤‡¶æ‡¶≠_‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®: netAmount
            };
        });
        
        const ws = XLSX.utils.json_to_sheet(partnersData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, '‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞');
        XLSX.writeFile(wb, 'partners_report.xlsx');
        showAlert('backupAlert', '‚úÖ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
    }

    function exportEmployeesToExcel() {
        const employeesData = employees.map(e => ({
            ‡¶®‡¶æ‡¶Æ: e.name,
            ‡¶™‡¶¶‡¶¨‡¶ø: e.position || '',
            ‡¶´‡ßã‡¶®: e.phone || '',
            ‡¶¨‡ßá‡¶§‡¶®: e.salary,
            ‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®: e.joinDate || '',
            ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: e.status === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'
        }));
        
        const ws = XLSX.utils.json_to_sheet(employeesData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, '‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ');
        XLSX.writeFile(wb, 'employees_report.xlsx');
        showAlert('backupAlert', '‚úÖ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
    }

    // Initialize the application
    init();
</script>
